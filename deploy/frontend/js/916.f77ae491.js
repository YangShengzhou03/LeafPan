"use strict";(self["webpackChunkfrontend"]=self["webpackChunkfrontend"]||[]).push([[916],{916:function(e,a,l){l.r(a),l.d(a,{default:function(){return I}});l(3617),l(1975),l(5673),l(164),l(1279);var t=l(5830),n=l(5302),o=l(5982),u=l(2703),s=l(7849),r=l(3489),d=l(7786);const i={class:"admin-logs"},p={class:"card-header"},c={class:"header-actions"},v={class:"filter-section"},b={class:"stats-section"},g={class:"stat-item"},k={class:"stat-value primary"},_={class:"stat-item"},F={class:"stat-value info"},L={class:"stat-item"},E={class:"stat-value warning"},f={class:"stat-item"},y={class:"stat-value success"},T={class:"stat-item"},m={class:"stat-value"},R={class:"stat-item"},h={class:"stat-value total"},C={class:"pagination-container"},D={key:0},w={class:"log-detail-content"};var A={__name:"LogsPage",setup(e){const a=(0,n.KR)(!1),l=(0,n.KR)(!1),A=(0,n.KR)(!1),S=(0,n.KR)([]),U=(0,n.KR)(0),I=(0,n.KR)(1),O=(0,n.KR)(20),W=(0,n.KR)(!1),V=(0,n.KR)(null),K=(0,n.KR)({uploadCount:0,downloadCount:0,deleteCount:0,loginCount:0,totalCount:0}),P=(0,n.Kh)({operationType:"",targetType:"",dateRange:[]}),z=e=>{switch(e){case"LOGIN":return"success";case"UPLOAD_FILE":return"primary";case"DOWNLOAD_FILE":return"info";case"DELETE_FILE":return"warning";case"UPDATE_USER_STATUS":return"danger";case"CLEAR_LOGS":return"danger";default:return""}},N=e=>{switch(e){case"LOGIN":return"登录";case"UPLOAD_FILE":return"上传文件";case"DOWNLOAD_FILE":return"下载文件";case"DELETE_FILE":return"删除文件";case"CREATE_SHARE":return"创建分享";case"DELETE_SHARE":return"删除分享";case"UPDATE_USER_STATUS":return"更新用户状态";case"CLEAR_LOGS":return"清空日志";default:return e}},Y=()=>{P.operationType="",P.targetType="",P.dateRange=[],I.value=1,H()},G=()=>{const e=S.value.filter(e=>"UPLOAD_FILE"===e.operationType).length,a=S.value.filter(e=>"DOWNLOAD_FILE"===e.operationType).length,l=S.value.filter(e=>"DELETE_FILE"===e.operationType).length,t=S.value.filter(e=>"LOGIN"===e.operationType).length;K.value={uploadCount:e,downloadCount:a,deleteCount:l,loginCount:t,totalCount:S.value.length}},H=async()=>{a.value=!0;try{const e=await d.A.get("/admin/log",{params:{page:I.value-1,size:O.value,operationType:P.operationType,targetType:P.targetType,startDate:P.dateRange?.[0],endDate:P.dateRange?.[1]}});S.value=e.data.content||[],U.value=e.data.totalElements||0,G()}catch(e){u.nk.error("加载日志数据失败")}finally{a.value=!1}},x=()=>{I.value=1,H()},j=e=>{O.value=e,I.value=1,H()},M=e=>{I.value=e,H()},B=e=>{V.value=e,W.value=!0},X=async()=>{l.value=!0;try{const e=await d.A.get("/admin/log/export",{responseType:"blob",params:{operationType:P.operationType,targetType:P.targetType,startDate:P.dateRange?.[0],endDate:P.dateRange?.[1]}}),a=new Blob([e.data],{type:"application/json"}),l=window.URL.createObjectURL(a),t=document.createElement("a");t.href=l,t.download=`logs_${(new Date).toISOString().substring(0,10)}.json`,t.click(),window.URL.revokeObjectURL(l),u.nk.success("日志导出成功")}catch(e){u.nk.error("导出日志失败")}finally{l.value=!1}},Q=async()=>{try{await s.s.confirm("确定要清空所有日志吗？此操作不可恢复！","确认清空",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}),A.value=!0,await d.A.delete("/admin/log"),S.value=[],U.value=0,u.nk.success("日志清空成功")}catch(e){"cancel"!==e&&u.nk.error("清空日志失败")}finally{A.value=!1}};return(0,t.sV)(()=>{H()}),(e,u)=>{const s=(0,t.g2)("el-icon"),d=(0,t.g2)("el-button"),G=(0,t.g2)("el-option"),H=(0,t.g2)("el-select"),$=(0,t.g2)("el-col"),q=(0,t.g2)("el-date-picker"),J=(0,t.g2)("el-row"),Z=(0,t.g2)("el-table-column"),ee=(0,t.g2)("el-tag"),ae=(0,t.g2)("el-table"),le=(0,t.g2)("el-pagination"),te=(0,t.g2)("el-card"),ne=(0,t.g2)("el-descriptions-item"),oe=(0,t.g2)("el-descriptions"),ue=(0,t.g2)("el-divider"),se=(0,t.g2)("el-dialog"),re=(0,t.gN)("loading");return(0,t.uX)(),(0,t.CE)("div",i,[(0,t.bF)(te,{class:"logs-card"},{header:(0,t.k6)(()=>[(0,t.Lk)("div",p,[u[8]||(u[8]=(0,t.Lk)("span",null,"操作日志",-1)),(0,t.Lk)("div",c,[(0,t.bF)(d,{onClick:X,loading:l.value},{default:(0,t.k6)(()=>[(0,t.bF)(s,null,{default:(0,t.k6)(()=>[(0,t.bF)((0,n.R1)(r.Download))]),_:1}),u[6]||(u[6]=(0,t.eW)(" 导出 ",-1))]),_:1},8,["loading"]),(0,t.bF)(d,{type:"danger",onClick:Q,loading:A.value},{default:(0,t.k6)(()=>[(0,t.bF)(s,null,{default:(0,t.k6)(()=>[(0,t.bF)((0,n.R1)(r.Delete))]),_:1}),u[7]||(u[7]=(0,t.eW)(" 清空 ",-1))]),_:1},8,["loading"])])])]),default:(0,t.k6)(()=>[(0,t.Lk)("div",v,[(0,t.bF)(J,{gutter:20},{default:(0,t.k6)(()=>[(0,t.bF)($,{span:5},{default:(0,t.k6)(()=>[(0,t.bF)(H,{modelValue:P.operationType,"onUpdate:modelValue":u[0]||(u[0]=e=>P.operationType=e),placeholder:"操作类型",clearable:"",onChange:x},{default:(0,t.k6)(()=>[(0,t.bF)(G,{label:"全部",value:""}),(0,t.bF)(G,{label:"登录",value:"LOGIN"}),(0,t.bF)(G,{label:"上传文件",value:"UPLOAD_FILE"}),(0,t.bF)(G,{label:"下载文件",value:"DOWNLOAD_FILE"}),(0,t.bF)(G,{label:"删除文件",value:"DELETE_FILE"}),(0,t.bF)(G,{label:"创建分享",value:"CREATE_SHARE"}),(0,t.bF)(G,{label:"删除分享",value:"DELETE_SHARE"}),(0,t.bF)(G,{label:"更新用户状态",value:"UPDATE_USER_STATUS"}),(0,t.bF)(G,{label:"清空日志",value:"CLEAR_LOGS"})]),_:1},8,["modelValue"])]),_:1}),(0,t.bF)($,{span:5},{default:(0,t.k6)(()=>[(0,t.bF)(H,{modelValue:P.targetType,"onUpdate:modelValue":u[1]||(u[1]=e=>P.targetType=e),placeholder:"目标类型",clearable:"",onChange:x},{default:(0,t.k6)(()=>[(0,t.bF)(G,{label:"全部",value:""}),(0,t.bF)(G,{label:"用户",value:"USER"}),(0,t.bF)(G,{label:"文件",value:"FILE"}),(0,t.bF)(G,{label:"文件夹",value:"FOLDER"}),(0,t.bF)(G,{label:"分享",value:"SHARE"}),(0,t.bF)(G,{label:"系统",value:"SYSTEM"})]),_:1},8,["modelValue"])]),_:1}),(0,t.bF)($,{span:8},{default:(0,t.k6)(()=>[(0,t.bF)(q,{modelValue:P.dateRange,"onUpdate:modelValue":u[2]||(u[2]=e=>P.dateRange=e),type:"daterange","range-separator":"至","start-placeholder":"开始日期","end-placeholder":"结束日期",format:"YYYY-MM-DD","value-format":"YYYY-MM-DD",onChange:x},null,8,["modelValue"])]),_:1}),(0,t.bF)($,{span:6},{default:(0,t.k6)(()=>[(0,t.bF)(d,{onClick:Y},{default:(0,t.k6)(()=>[...u[9]||(u[9]=[(0,t.eW)("重置",-1)])]),_:1})]),_:1})]),_:1})]),(0,t.Lk)("div",b,[(0,t.bF)(J,{gutter:20},{default:(0,t.k6)(()=>[(0,t.bF)($,{span:4},{default:(0,t.k6)(()=>[(0,t.Lk)("div",g,[u[10]||(u[10]=(0,t.Lk)("span",{class:"stat-label"},"上传：",-1)),(0,t.Lk)("span",k,(0,o.v_)(K.value.uploadCount),1)])]),_:1}),(0,t.bF)($,{span:4},{default:(0,t.k6)(()=>[(0,t.Lk)("div",_,[u[11]||(u[11]=(0,t.Lk)("span",{class:"stat-label"},"下载：",-1)),(0,t.Lk)("span",F,(0,o.v_)(K.value.downloadCount),1)])]),_:1}),(0,t.bF)($,{span:4},{default:(0,t.k6)(()=>[(0,t.Lk)("div",L,[u[12]||(u[12]=(0,t.Lk)("span",{class:"stat-label"},"删除：",-1)),(0,t.Lk)("span",E,(0,o.v_)(K.value.deleteCount),1)])]),_:1}),(0,t.bF)($,{span:4},{default:(0,t.k6)(()=>[(0,t.Lk)("div",f,[u[13]||(u[13]=(0,t.Lk)("span",{class:"stat-label"},"登录：",-1)),(0,t.Lk)("span",y,(0,o.v_)(K.value.loginCount),1)])]),_:1}),(0,t.bF)($,{span:4},{default:(0,t.k6)(()=>[(0,t.Lk)("div",T,[u[14]||(u[14]=(0,t.Lk)("span",{class:"stat-label"},"分享：",-1)),(0,t.Lk)("span",m,(0,o.v_)(S.value.filter(e=>"CREATE_SHARE"===e.operationType||"DELETE_SHARE"===e.operationType).length),1)])]),_:1}),(0,t.bF)($,{span:4},{default:(0,t.k6)(()=>[(0,t.Lk)("div",R,[u[15]||(u[15]=(0,t.Lk)("span",{class:"stat-label"},"总计：",-1)),(0,t.Lk)("span",h,(0,o.v_)(K.value.totalCount),1)])]),_:1})]),_:1})]),(0,t.bo)(((0,t.uX)(),(0,t.Wv)(ae,{data:S.value,style:{width:"100%"},stripe:""},{default:(0,t.k6)(()=>[(0,t.bF)(Z,{prop:"id",label:"ID",width:"80"}),(0,t.bF)(Z,{prop:"operationType",label:"操作类型",width:"200"},{default:(0,t.k6)(({row:e})=>[(0,t.bF)(ee,{type:z(e.operationType),size:"small"},{default:(0,t.k6)(()=>[(0,t.eW)((0,o.v_)(N(e.operationType)),1)]),_:2},1032,["type"])]),_:1}),(0,t.bF)(Z,{prop:"description",label:"描述","min-width":"200","show-overflow-tooltip":""}),(0,t.bF)(Z,{prop:"ipAddress",label:"IP地址",width:"130"}),(0,t.bF)(Z,{prop:"createTime",label:"时间",width:"160"}),(0,t.bF)(Z,{label:"操作",width:"100",fixed:"right"},{default:(0,t.k6)(({row:e})=>[(0,t.bF)(d,{type:"primary",size:"small",onClick:a=>B(e)},{default:(0,t.k6)(()=>[...u[16]||(u[16]=[(0,t.eW)(" 详情 ",-1)])]),_:1},8,["onClick"])]),_:1})]),_:1},8,["data"])),[[re,a.value]]),(0,t.Lk)("div",C,[(0,t.bF)(le,{"current-page":I.value,"onUpdate:currentPage":u[3]||(u[3]=e=>I.value=e),"page-size":O.value,"onUpdate:pageSize":u[4]||(u[4]=e=>O.value=e),"page-sizes":[10,20,50,100],total:U.value,layout:"total, sizes, prev, pager, next, jumper",onSizeChange:j,onCurrentChange:M},null,8,["current-page","page-size","total"])])]),_:1}),(0,t.bF)(se,{modelValue:W.value,"onUpdate:modelValue":u[5]||(u[5]=e=>W.value=e),title:"日志详情",width:"600px"},{default:(0,t.k6)(()=>[V.value?((0,t.uX)(),(0,t.CE)("div",D,[(0,t.bF)(oe,{column:1,border:""},{default:(0,t.k6)(()=>[(0,t.bF)(ne,{label:"ID"},{default:(0,t.k6)(()=>[(0,t.eW)((0,o.v_)(V.value.id),1)]),_:1}),(0,t.bF)(ne,{label:"操作类型"},{default:(0,t.k6)(()=>[(0,t.bF)(ee,{type:z(V.value.operationType)},{default:(0,t.k6)(()=>[(0,t.eW)((0,o.v_)(N(V.value.operationType)),1)]),_:1},8,["type"])]),_:1}),(0,t.bF)(ne,{label:"IP地址"},{default:(0,t.k6)(()=>[(0,t.eW)((0,o.v_)(V.value.ipAddress),1)]),_:1}),(0,t.bF)(ne,{label:"时间"},{default:(0,t.k6)(()=>[(0,t.eW)((0,o.v_)(V.value.createTime),1)]),_:1}),(0,t.bF)(ne,{label:"描述"},{default:(0,t.k6)(()=>[(0,t.eW)((0,o.v_)(V.value.description),1)]),_:1})]),_:1}),(0,t.bF)(ue),u[17]||(u[17]=(0,t.Lk)("h4",null,"详细信息",-1)),(0,t.Lk)("div",w,(0,o.v_)(V.value.userAgent),1)])):(0,t.Q3)("",!0)]),_:1},8,["modelValue"])])}}},S=l(3007);const U=(0,S.A)(A,[["__scopeId","data-v-146b11bc"]]);var I=U}}]);
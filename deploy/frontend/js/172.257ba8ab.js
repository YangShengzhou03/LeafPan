"use strict";(self["webpackChunkfrontend"]=self["webpackChunkfrontend"]||[]).push([[172],{4172:function(e,a,l){l.r(a),l.d(a,{default:function(){return _}});l(3617),l(1975),l(3991);var t=l(5830),o=l(5302),s=l(2744),r=l(5982),u=l(2703),d=l(7849),n=l(3489),i=l(7786);const p={class:"admin-users"},g={class:"card-header"},c={class:"users-content"},m={class:"search-bar"},b={class:"table-container"},v={class:"truncate-id"},k={class:"pagination-container"},w={class:"dialog-footer"};var f={__name:"UsersPage",setup(e){const a=(0,o.KR)(!1),l=(0,o.KR)([]),f=(0,o.KR)(""),F=(0,o.KR)(""),h=(0,o.KR)(""),_=(0,o.KR)(1),y=(0,o.KR)(20),V=(0,o.KR)(0),L=(0,o.KR)(!1),C=(0,o.KR)(null),E=(0,o.KR)(null),Q=(0,o.Kh)({email:"",password:"",gender:"NOT_SET",phone:"",role:"user",status:"active",storageQuota:1}),T={email:[{required:!0,message:"请输入邮箱地址",trigger:"blur"},{type:"email",message:"请输入正确的邮箱地址",trigger:"blur"}],password:[{required:!0,message:"请输入密码",trigger:"blur"},{min:6,max:20,message:"长度在 6 到 20 个字符",trigger:"blur"}],gender:[{required:!0,message:"请选择性别",trigger:"change"}],phone:[{pattern:/^1[3456789]\d{9}$/,message:"请输入正确的手机号",trigger:"blur"}],role:[{required:!0,message:"请选择用户角色",trigger:"change"}],status:[{required:!0,message:"请选择用户状态",trigger:"change"}],storageQuota:[{required:!0,message:"请设置存储配额",trigger:"blur"}]},U=(0,t.EW)(()=>{let e=l.value;if(f.value){const a=f.value.toLowerCase();e=e.filter(e=>e.email.toLowerCase().includes(a))}return F.value&&(e=e.filter(e=>e.status===F.value)),h.value&&(e=e.filter(e=>e.role===h.value)),e}),A=e=>{if(0===e)return"0 B";const a=1024,l=["B","KB","MB","GB","TB"],t=Math.floor(Math.log(e)/Math.log(a));return parseFloat((e/Math.pow(a,t)).toFixed(2))+" "+l[t]},W=(e,a)=>a&&0!==a?Math.round(e/a*100):0,M=async()=>{a.value=!0;try{const e=await i.A.get("/admin/user/list",{params:{page:_.value-1,size:y.value}});if(200!==e.code)throw new Error(e.message);{const a=e.data;l.value=a.content.map(e=>({id:e.id,email:e.email,gender:1===e.gender?"MALE":2===e.gender?"FEMALE":"NOT_SET",phone:e.phone||"",role:1===e.role?"admin":"user",storageQuota:e.storageQuota||1073741824,storageUsed:e.usedStorage||0,status:1===e.status?"active":"disabled",lastLoginTime:e.lastLoginTime?new Date(e.lastLoginTime).toLocaleString("zh-CN"):"从未登录",createdAt:e.createdTime?new Date(e.createdTime).toLocaleString("zh-CN"):"未知"})),V.value=a.totalElements}}catch(e){u.nk.error("加载用户数据失败: "+(e.response?.data?.message||e.message))}finally{a.value=!1}},R=()=>{_.value=1,M()},K=()=>{f.value="",F.value="",h.value="",_.value=1,M()},x=async e=>{try{await d.s.confirm(`确定要重置用户 "${e.email}" 的密码为"123456"吗？`,"确认重置密码",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}),await i.A.put(`/admin/user/${e.id}/password?newPassword=123456`),u.nk.success("密码重置成功，新密码为：123456")}catch(a){"cancel"!==a&&u.nk.error("重置密码失败: "+(a.response?.data?.message||a.message))}},z=e=>{y.value=e,M()},B=e=>{_.value=e,M()},S=e=>{C.value=e,Q.email=e.email,Q.gender=e.gender,Q.phone=e.phone,Q.role=e.role,Q.status=e.status,Q.storageQuota=Math.round(e.storageQuota/1073741824),Q.password="",L.value=!0},$=async()=>{if(E.value)try{await E.value.validate();const e=1024*Q.storageQuota*1024*1024,a={email:Q.email,password:Q.password,gender:"MALE"===Q.gender?1:"FEMALE"===Q.gender?2:0,phone:Q.phone,role:"admin"===Q.role?1:0,status:"active"===Q.status?1:0,storageQuota:e};if(C.value)await i.A.put(`/admin/user/${C.value.id}`,a);else{const a={email:Q.email,password:Q.password,nickname:Q.email.split("@")[0],gender:"MALE"===Q.gender?1:"FEMALE"===Q.gender?2:0,phone:Q.phone,role:"admin"===Q.role?1:0,status:"active"===Q.status?1:0,storageQuota:e};await i.A.post("/admin/user",a)}u.nk.success(C.value?"用户更新成功":"用户添加成功"),L.value=!1,C.value=null,P(),M()}catch(e){!1!==e&&u.nk.error("保存用户失败: "+(e.response?.data?.message||e.message))}},N=async e=>{try{const a="active"===e.status?"disabled":"active",l="active"===a;await i.A.put(`/admin/user/${e.id}/status?enabled=${l}`),u.nk.success("用户已"+("active"===a?"启用":"禁用")),M()}catch(a){u.nk.error("切换用户状态失败: "+(a.response?.data?.message||a.message))}},q=async e=>{try{await d.s.confirm(`确定要删除用户 "${e.email}" 吗？此操作不可恢复。`,"确认删除",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}),await i.A.delete(`/admin/user/${e.id}`),u.nk.success("用户删除成功"),M()}catch(a){"cancel"!==a&&u.nk.error("删除用户失败: "+(a.response?.data?.message||a.message))}},O=(e,a)=>{const l=W(e,a);return l>=90?"usage-high":l>=70?"usage-medium":"usage-low"},P=()=>{Object.assign(Q,{email:"",password:"",gender:"NOT_SET",phone:"",role:"user",status:"active",storageQuota:1})};return(0,t.sV)(()=>{M()}),(e,l)=>{const u=(0,t.g2)("el-icon"),d=(0,t.g2)("el-button"),i=(0,t.g2)("el-input"),M=(0,t.g2)("el-col"),P=(0,t.g2)("el-option"),j=(0,t.g2)("el-select"),D=(0,t.g2)("el-row"),X=(0,t.g2)("el-table-column"),G=(0,t.g2)("el-tag"),I=(0,t.g2)("el-table"),H=(0,t.g2)("el-pagination"),J=(0,t.g2)("el-card"),Y=(0,t.g2)("el-form-item"),Z=(0,t.g2)("el-radio"),ee=(0,t.g2)("el-radio-group"),ae=(0,t.g2)("el-input-number"),le=(0,t.g2)("el-form"),te=(0,t.g2)("el-dialog"),oe=(0,t.gN)("loading");return(0,t.uX)(),(0,t.CE)("div",p,[(0,t.bF)(J,{class:"users-card"},{header:(0,t.k6)(()=>[(0,t.Lk)("div",g,[l[16]||(l[16]=(0,t.Lk)("span",null,"用户管理",-1)),(0,t.bF)(d,{type:"primary",onClick:l[0]||(l[0]=e=>L.value=!0)},{default:(0,t.k6)(()=>[(0,t.bF)(u,null,{default:(0,t.k6)(()=>[(0,t.bF)((0,o.R1)(n.Plus))]),_:1}),l[15]||(l[15]=(0,t.eW)(" 添加用户 ",-1))]),_:1})])]),default:(0,t.k6)(()=>[(0,t.Lk)("div",c,[(0,t.Lk)("div",m,[(0,t.bF)(D,{gutter:20},{default:(0,t.k6)(()=>[(0,t.bF)(M,{span:8},{default:(0,t.k6)(()=>[(0,t.bF)(i,{modelValue:f.value,"onUpdate:modelValue":l[1]||(l[1]=e=>f.value=e),placeholder:"搜索邮箱",clearable:"",onClear:R,onKeyup:(0,s.jR)(R,["enter"])},{append:(0,t.k6)(()=>[(0,t.bF)(d,{onClick:R},{default:(0,t.k6)(()=>[(0,t.bF)(u,null,{default:(0,t.k6)(()=>[(0,t.bF)((0,o.R1)(n.Search))]),_:1})]),_:1})]),_:1},8,["modelValue"])]),_:1}),(0,t.bF)(M,{span:6},{default:(0,t.k6)(()=>[(0,t.bF)(j,{modelValue:F.value,"onUpdate:modelValue":l[2]||(l[2]=e=>F.value=e),placeholder:"用户状态",clearable:"",onChange:R},{default:(0,t.k6)(()=>[(0,t.bF)(P,{label:"全部",value:""}),(0,t.bF)(P,{label:"正常",value:"active"}),(0,t.bF)(P,{label:"禁用",value:"disabled"})]),_:1},8,["modelValue"])]),_:1}),(0,t.bF)(M,{span:6},{default:(0,t.k6)(()=>[(0,t.bF)(j,{modelValue:h.value,"onUpdate:modelValue":l[3]||(l[3]=e=>h.value=e),placeholder:"用户角色",clearable:"",onChange:R},{default:(0,t.k6)(()=>[(0,t.bF)(P,{label:"全部",value:""}),(0,t.bF)(P,{label:"普通用户",value:"user"}),(0,t.bF)(P,{label:"管理员",value:"admin"})]),_:1},8,["modelValue"])]),_:1}),(0,t.bF)(M,{span:4},{default:(0,t.k6)(()=>[(0,t.bF)(d,{onClick:K},{default:(0,t.k6)(()=>[...l[17]||(l[17]=[(0,t.eW)("重置",-1)])]),_:1})]),_:1})]),_:1})]),(0,t.Lk)("div",b,[(0,t.bo)(((0,t.uX)(),(0,t.Wv)(I,{data:U.value,style:{width:"100%"},scroll:{x:1200}},{default:(0,t.k6)(()=>[(0,t.bF)(X,{prop:"id",label:"ID",width:"180","show-overflow-tooltip":!0},{default:(0,t.k6)(e=>[(0,t.Lk)("span",v,(0,r.v_)(e.row.id),1)]),_:1}),(0,t.bF)(X,{prop:"email",label:"邮箱",width:"180","show-overflow-tooltip":!0}),(0,t.bF)(X,{prop:"gender",label:"性别",width:"80"},{default:(0,t.k6)(e=>[(0,t.eW)((0,r.v_)("MALE"===e.row.gender?"男":"FEMALE"===e.row.gender?"女":"未设置"),1)]),_:1}),(0,t.bF)(X,{prop:"phone",label:"手机号",width:"120","show-overflow-tooltip":!0}),(0,t.bF)(X,{prop:"role",label:"角色",width:"100"},{default:(0,t.k6)(e=>[(0,t.bF)(G,{type:"admin"===e.row.role?"danger":"primary"},{default:(0,t.k6)(()=>[(0,t.eW)((0,r.v_)("admin"===e.row.role?"管理员":"普通用户"),1)]),_:2},1032,["type"])]),_:1}),(0,t.bF)(X,{prop:"storageQuota",label:"总配额",width:"100"},{default:(0,t.k6)(e=>[(0,t.eW)((0,r.v_)(A(e.row.storageQuota)),1)]),_:1}),(0,t.bF)(X,{prop:"storageUsed",label:"存储使用",width:"140"},{default:(0,t.k6)(({row:e})=>[(0,t.eW)((0,r.v_)(A(e.storageUsed))+" / "+(0,r.v_)(A(e.storageQuota)),1)]),_:1}),(0,t.bF)(X,{prop:"usagePercentage",label:"使用率",width:"80"},{default:(0,t.k6)(({row:e})=>[(0,t.Lk)("span",{class:(0,r.C4)(O(e.storageUsed,e.storageQuota))},(0,r.v_)(W(e.storageUsed,e.storageQuota))+"% ",3)]),_:1}),(0,t.bF)(X,{prop:"status",label:"状态",width:"100"},{default:(0,t.k6)(e=>[(0,t.bF)(G,{type:"active"===e.row.status?"success":"danger"},{default:(0,t.k6)(()=>[(0,t.eW)((0,r.v_)("active"===e.row.status?"正常":"禁用"),1)]),_:2},1032,["type"])]),_:1}),(0,t.bF)(X,{prop:"lastLoginTime",label:"最后上线时间",width:"200","show-overflow-tooltip":!0}),(0,t.bF)(X,{label:"操作",width:"280",fixed:"right"},{default:(0,t.k6)(e=>[(0,t.bF)(d,{size:"small",onClick:a=>S(e.row)},{default:(0,t.k6)(()=>[...l[18]||(l[18]=[(0,t.eW)("编辑",-1)])]),_:1},8,["onClick"]),(0,t.bF)(d,{size:"small",type:"active"===e.row.status?"warning":"success",onClick:a=>N(e.row)},{default:(0,t.k6)(()=>[(0,t.eW)((0,r.v_)("active"===e.row.status?"禁用":"启用"),1)]),_:2},1032,["type","onClick"]),(0,t.bF)(d,{size:"small",type:"info",onClick:a=>x(e.row)},{default:(0,t.k6)(()=>[...l[19]||(l[19]=[(0,t.eW)("重置密码",-1)])]),_:1},8,["onClick"]),(0,t.bF)(d,{size:"small",type:"danger",onClick:a=>q(e.row)},{default:(0,t.k6)(()=>[...l[20]||(l[20]=[(0,t.eW)("删除",-1)])]),_:1},8,["onClick"])]),_:1})]),_:1},8,["data"])),[[oe,a.value]])]),(0,t.Lk)("div",k,[(0,t.bF)(H,{"current-page":_.value,"onUpdate:currentPage":l[4]||(l[4]=e=>_.value=e),"page-size":y.value,"onUpdate:pageSize":l[5]||(l[5]=e=>y.value=e),"page-sizes":[10,20,50,100],layout:"total, sizes, prev, pager, next, jumper",total:V.value,onSizeChange:z,onCurrentChange:B},null,8,["current-page","page-size","total"])])])]),_:1}),(0,t.bF)(te,{modelValue:L.value,"onUpdate:modelValue":l[14]||(l[14]=e=>L.value=e),title:C.value?"编辑用户":"添加用户",width:"500px"},{footer:(0,t.k6)(()=>[(0,t.Lk)("span",w,[(0,t.bF)(d,{onClick:l[13]||(l[13]=e=>L.value=!1)},{default:(0,t.k6)(()=>[...l[24]||(l[24]=[(0,t.eW)("取消",-1)])]),_:1}),(0,t.bF)(d,{type:"primary",onClick:$},{default:(0,t.k6)(()=>[...l[25]||(l[25]=[(0,t.eW)("确定",-1)])]),_:1})])]),default:(0,t.k6)(()=>[(0,t.bF)(le,{model:Q,rules:T,ref_key:"userFormRef",ref:E,"label-width":"80px"},{default:(0,t.k6)(()=>[(0,t.bF)(Y,{label:"邮箱",prop:"email"},{default:(0,t.k6)(()=>[(0,t.bF)(i,{modelValue:Q.email,"onUpdate:modelValue":l[6]||(l[6]=e=>Q.email=e)},null,8,["modelValue"])]),_:1}),C.value?(0,t.Q3)("",!0):((0,t.uX)(),(0,t.Wv)(Y,{key:0,label:"密码",prop:"password"},{default:(0,t.k6)(()=>[(0,t.bF)(i,{modelValue:Q.password,"onUpdate:modelValue":l[7]||(l[7]=e=>Q.password=e),type:"password","show-password":""},null,8,["modelValue"])]),_:1})),(0,t.bF)(Y,{label:"性别",prop:"gender"},{default:(0,t.k6)(()=>[(0,t.bF)(j,{modelValue:Q.gender,"onUpdate:modelValue":l[8]||(l[8]=e=>Q.gender=e),style:{width:"100%"}},{default:(0,t.k6)(()=>[(0,t.bF)(P,{label:"男",value:"MALE"}),(0,t.bF)(P,{label:"女",value:"FEMALE"}),(0,t.bF)(P,{label:"未设置",value:"NOT_SET"})]),_:1},8,["modelValue"])]),_:1}),(0,t.bF)(Y,{label:"手机号",prop:"phone"},{default:(0,t.k6)(()=>[(0,t.bF)(i,{modelValue:Q.phone,"onUpdate:modelValue":l[9]||(l[9]=e=>Q.phone=e)},null,8,["modelValue"])]),_:1}),(0,t.bF)(Y,{label:"角色",prop:"role"},{default:(0,t.k6)(()=>[(0,t.bF)(j,{modelValue:Q.role,"onUpdate:modelValue":l[10]||(l[10]=e=>Q.role=e),style:{width:"100%"}},{default:(0,t.k6)(()=>[(0,t.bF)(P,{label:"普通用户",value:"user"}),(0,t.bF)(P,{label:"管理员",value:"admin"})]),_:1},8,["modelValue"])]),_:1}),(0,t.bF)(Y,{label:"状态",prop:"status"},{default:(0,t.k6)(()=>[(0,t.bF)(ee,{modelValue:Q.status,"onUpdate:modelValue":l[11]||(l[11]=e=>Q.status=e)},{default:(0,t.k6)(()=>[(0,t.bF)(Z,{label:"active"},{default:(0,t.k6)(()=>[...l[21]||(l[21]=[(0,t.eW)("正常",-1)])]),_:1}),(0,t.bF)(Z,{label:"disabled"},{default:(0,t.k6)(()=>[...l[22]||(l[22]=[(0,t.eW)("禁用",-1)])]),_:1})]),_:1},8,["modelValue"])]),_:1}),(0,t.bF)(Y,{label:"存储配额",prop:"storageQuota"},{default:(0,t.k6)(()=>[(0,t.bF)(ae,{modelValue:Q.storageQuota,"onUpdate:modelValue":l[12]||(l[12]=e=>Q.storageQuota=e),min:1,max:1e3},null,8,["modelValue"]),l[23]||(l[23]=(0,t.Lk)("span",{style:{"margin-left":"10px"}},"GB",-1))]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue","title"])])}}},F=l(3007);const h=(0,F.A)(f,[["__scopeId","data-v-9e11b1b4"]]);var _=h}}]);
(function(){"use strict";var e={2320:function(e,a,t){function l(){return!!localStorage.getItem("token")}function n(e){localStorage.setItem("token",e)}function s(){localStorage.removeItem("token")}function r(){return localStorage.getItem("token")}function i(e){if(0===e)return"0 Bytes";const a=1024,t=["Bytes","KB","MB","GB","TB"],l=Math.floor(Math.log(e)/Math.log(a));return parseFloat((e/Math.pow(a,l)).toFixed(2))+" "+t[l]}function o(e){const a=new Date(e);return a.toLocaleDateString()+" "+a.toLocaleTimeString()}t.d(a,{M3:function(){return l},Yq:function(){return o},eF:function(){return s},f7:function(){return n},gf:function(){return r},v7:function(){return i}})},7786:function(e,a,t){var l=t(9569),n=t(2320),s=t(2703);const r=l.A.create({baseURL:"/api",timeout:1e4});r.interceptors.request.use(e=>{const a=(0,n.gf)();return a&&(e.headers.Authorization=`Bearer ${a}`),e}),r.interceptors.response.use(e=>e.data&&void 0!==e.data.code?200===e.data.code?e.data:(s.nk.error(e.data.message||"请求失败"),Promise.reject(new Error(e.data.message||"请求失败"))):e,e=>{if(!e.response)return s.nk.error("网络连接失败，请检查网络设置"),Promise.reject(e);const a=e.response.status,t=e.response.data?.message||"请求失败";switch(a){case 401:s.nk.error("登录已过期，请重新登录"),(0,n.eF)(),"/login"!==window.location.pathname&&(window.location.href="/login");break;case 403:s.nk.error("权限不足，无法访问该资源");break;case 404:s.nk.error("请求的资源不存在");break;case 500:s.nk.error("服务器内部错误，请稍后重试");break;default:s.nk.error(t)}return Promise.reject(e)});const i={get:(e,a={})=>r.get(e,{params:a}),post:(e,a={})=>r.post(e,a),put:(e,a={})=>r.put(e,a),delete:(e,a={})=>r.delete(e,{params:a}),upload:(e,a,t)=>r.post(e,a,{onUploadProgress:t})};a.A=i},9321:function(e,a,t){var l=t(2744),n=t(293),s=(t(8926),t(6940)),r=t(5830),i=t(5982);const o={class:"index-layout"},d={class:"header"},u={class:"container"},c={key:0,class:"auth-buttons"},v={key:1,class:"user-info"},m={class:"welcome-text"},f={class:"main-content"},p={class:"hero-section"},k={class:"container"},g={class:"hero-content"},b={class:"cta-buttons"};function h(e,a,t,l,n,s){const h=(0,r.g2)("ElButton");return(0,r.uX)(),(0,r.CE)("div",o,[(0,r.Lk)("header",d,[(0,r.Lk)("div",u,[a[4]||(a[4]=(0,r.Lk)("div",{class:"logo-area"},[(0,r.Lk)("h1",null,"枫叶网盘")],-1)),l.isAuthenticated?((0,r.uX)(),(0,r.CE)("div",v,[(0,r.Lk)("span",m,[a[3]||(a[3]=(0,r.eW)(" 您好， ",-1)),(0,r.Lk)("span",{class:"username-link",onClick:a[0]||(a[0]=(...e)=>l.goToUserLayout&&l.goToUserLayout(...e))},(0,i.v_)(l.currentUser?.nickname||l.currentUser?.email||"枫叶用户"),1)])])):((0,r.uX)(),(0,r.CE)("div",c,[(0,r.bF)(h,{type:"default",class:"register-btn",onClick:l.handleRegister},{default:(0,r.k6)(()=>[...a[1]||(a[1]=[(0,r.eW)("注册",-1)])]),_:1},8,["onClick"]),(0,r.bF)(h,{type:"primary",class:"login-btn",onClick:l.handleLogin},{default:(0,r.k6)(()=>[...a[2]||(a[2]=[(0,r.eW)("登录",-1)])]),_:1},8,["onClick"])]))])]),(0,r.Lk)("main",f,[(0,r.Lk)("section",p,[(0,r.Lk)("div",k,[(0,r.Lk)("div",g,[a[6]||(a[6]=(0,r.Lk)("h1",null,"安全可靠的云存储",-1)),a[7]||(a[7]=(0,r.Lk)("p",null,"轻松存储，随时访问，让您的数据安全无忧",-1)),(0,r.Lk)("div",b,[(0,r.bF)(h,{type:"primary",size:"large",class:"start-btn",onClick:l.handleStart},{default:(0,r.k6)(()=>[(0,r.eW)((0,i.v_)(l.isAuthenticated?"进入我的网盘":"免费开始使用"),1)]),_:1},8,["onClick"]),(0,r.bF)(h,{type:"default",size:"large",class:"demo-btn",onClick:l.handleDemo},{default:(0,r.k6)(()=>[...a[5]||(a[5]=[(0,r.eW)("查看演示",-1)])]),_:1},8,["onClick"])])]),a[8]||(a[8]=(0,r.Lk)("div",{class:"hero-image"},[(0,r.Lk)("h2",null,"广告位展示"),(0,r.Lk)("p",null,"您能看到，您的潜在用户也能看到")],-1))])]),a[9]||(a[9]=(0,r.Fv)('<section id="features" class="features-section" data-v-563644a7><div class="container" data-v-563644a7><h2 data-v-563644a7>枫叶的竞争力在哪？</h2><div class="features-grid" data-v-563644a7><div class="feature-card" data-v-563644a7><div class="feature-icon" data-v-563644a7><i class="el-icon-cloudy" data-v-563644a7></i></div><h3 data-v-563644a7>数据安全</h3><p data-v-563644a7>三重加密保护，数据安全是我们的生命。</p></div><div class="feature-card" data-v-563644a7><div class="feature-icon" data-v-563644a7><i class="el-icon-share" data-v-563644a7></i></div><h3 data-v-563644a7>便捷分享</h3><p data-v-563644a7>一键分享文件给朋友，自由查看和编辑。</p></div><div class="feature-card" data-v-563644a7><div class="feature-icon" data-v-563644a7><i class="el-icon-mobile-phone" data-v-563644a7></i></div><h3 data-v-563644a7>多设备同步</h3><p data-v-563644a7>电脑、手机、平板随时随地访问，文件最新。</p></div><div class="feature-card" data-v-563644a7><div class="feature-icon" data-v-563644a7><i class="el-icon-download" data-v-563644a7></i></div><h3 data-v-563644a7>高速下载</h3><p data-v-563644a7>大文件也能全速下载，您的时间十分宝贵。</p></div></div></div></section><section class="pricing-section" id="pricing" data-v-563644a7><div class="container" data-v-563644a7><h2 data-v-563644a7>选择适合您的方案</h2><div class="pricing-cards" data-v-563644a7><div class="pricing-card" data-v-563644a7><h3 data-v-563644a7>入门体验</h3><div class="price" data-v-563644a7>免费</div><ul class="features-list" data-v-563644a7><li data-v-563644a7>5GB 存储空间</li><li data-v-563644a7>基础文件管理功能</li><li data-v-563644a7>标准下载速度</li></ul></div><div class="pricing-card popular" data-v-563644a7><div class="badge" data-v-563644a7>热门选择</div><h3 data-v-563644a7>会员套餐</h3><div class="price" data-v-563644a7>¥1.99<span data-v-563644a7>/月</span></div><ul class="features-list" data-v-563644a7><li data-v-563644a7>100GB 存储空间</li><li data-v-563644a7>高级文件管理工具</li><li data-v-563644a7>高速下载通道</li><li data-v-563644a7>文件分享功能</li></ul></div><div class="pricing-card" data-v-563644a7><h3 data-v-563644a7>至尊套餐</h3><div class="price" data-v-563644a7>¥39<span data-v-563644a7>/月</span></div><ul class="features-list" data-v-563644a7><li data-v-563644a7>1TB 存储空间</li><li data-v-563644a7>专业文件管理工具</li><li data-v-563644a7>极速下载通道</li><li data-v-563644a7>高级分享功能</li><li data-v-563644a7>团队协作工具</li></ul></div></div></div></section>',2))]),a[10]||(a[10]=(0,r.Fv)('<footer class="footer" data-v-563644a7><div class="container" data-v-563644a7><div class="footer-content" data-v-563644a7><div class="footer-section" data-v-563644a7><h3 data-v-563644a7>关于枫叶网盘</h3><p data-v-563644a7>让每个人都能轻松享受云存储的便利</p></div><div class="footer-section" data-v-563644a7><h4 data-v-563644a7>产品服务</h4><ul data-v-563644a7><li data-v-563644a7><a href="#features" data-v-563644a7>功能特色</a></li><li data-v-563644a7><a href="#pricing" data-v-563644a7>价格方案</a></li></ul></div><div class="footer-section" data-v-563644a7><h4 data-v-563644a7>帮助支持</h4><ul data-v-563644a7><li data-v-563644a7><a href="#" data-v-563644a7>使用指南</a></li><li data-v-563644a7><a href="#" data-v-563644a7>联系我们</a></li><li data-v-563644a7><a href="#" data-v-563644a7>常见问题</a></li></ul></div><div class="footer-section" data-v-563644a7><h4 data-v-563644a7>法律信息</h4><ul data-v-563644a7><li data-v-563644a7><a href="#" data-v-563644a7>作者介绍</a></li><li data-v-563644a7><a href="#" data-v-563644a7>隐私保护</a></li><li data-v-563644a7><a href="#" data-v-563644a7>服务条款</a></li></ul></div></div><div class="footer-bottom" data-v-563644a7><p data-v-563644a7>© 2025 枫叶网盘. 保留所有权利.</p></div></div></footer>',1))])}t(5724);var y=t(2703),F=t(5302),_=t(7786),w=t(2320);const L=(0,F.Kh)({user:null,isAuthenticated:w.M3(),loading:!1,isAdmin:!1,storageInfo:{totalStorageGB:0,usedStorageGB:0}}),C={state:L,setUser(e){e&&(L.user=e,L.isAuthenticated=!0,L.isAdmin=1===e.role||"ADMIN"===e.role||"admin"===e.role,e.storageInfo&&(L.storageInfo=e.storageInfo))},clearUser(){L.user=null,L.isAuthenticated=!1,L.isAdmin=!1,w.eF(),L.storageInfo={totalStorageGB:0,usedStorageGB:0}},updateStorageInfo(e){e&&(L.storageInfo=e)},async login(e){L.loading=!0;try{const a=await _.A.post("/auth/login",e);if(a&&200===a.code&&a.data){const{token:e,user:t}=a.data;return e&&w.f7(e),t?this.setUser(t):await this.fetchCurrentUser(),{success:!0,message:a.message||"登录成功",user:t}}return{success:!1,message:a?.message||"登录失败"}}catch(a){return this.clearUser(),{success:!1,message:a.response?.data?.message||"登录失败，请检查网络连接"}}finally{L.loading=!1}},async register(e){L.loading=!0;try{return await _.A.post("/auth/register",e),{success:!0,message:"注册成功"}}catch(a){return{success:!1,message:a.response?.data?.message||a.message}}finally{L.loading=!1}},async sendVerificationCode(e){L.loading=!0;try{return await _.A.post("/verification/send",{email:e}),{success:!0,message:"验证码发送成功"}}catch(a){return{success:!1,message:a.response?.data?.message||a.message}}finally{L.loading=!1}},async fetchCurrentUser(){if(w.M3())try{const e=await _.A.get("/auth/me");e&&200===e.code&&e.data&&(this.setUser(e.data),e.data.storageInfo&&this.updateStorageInfo(e.data.storageInfo))}catch(e){!e.response||401!==e.response.status&&403!==e.response.status||this.clearUser()}else this.clearUser()},async fetchStorageInfo(){if(!w.M3())return null;try{const e=await _.A.get("/user/storage"),a=e.data||e;return a&&(L.storageInfo={totalStorageGB:a.storageQuota?a.storageQuota/1073741824:0,usedStorageGB:a.usedStorage?a.usedStorage/1073741824:0,availableStorageGB:a.availableStorage?a.availableStorage/1073741824:0,usagePercentage:a.usagePercentage||0}),a}catch(e){return null}},async updateProfile(e){L.loading=!0;try{const a=await _.A.put("/user/profile",e);return this.setUser(a.data),{success:!0,message:"更新成功"}}catch(a){return{success:!1,message:a.response?.data?.message||a.message}}finally{L.loading=!1}},async updatePassword(e){L.loading=!0;try{return await _.A.put("/user/password",e),{success:!0,message:"密码更新成功"}}catch(a){return{success:!1,message:a.response?.data?.message||a.message}}finally{L.loading=!1}},async logout(){try{await _.A.post("/auth/logout")}catch(e){}finally{this.clearUser()}},async init(){if(w.M3())try{return await this.fetchCurrentUser(),await this.fetchStorageInfo(),!0}catch(e){return!e.response||401!==e.response.status&&403!==e.response.status||this.clearUser(),!1}return!1}};var R=C,A={name:"IndexLayout",setup(){const e=(0,r.EW)(()=>R.state.isAuthenticated),a=(0,r.EW)(()=>R.state.user),t=(0,s.rd)(),l=()=>{t.push("/user")},n=()=>{t.push("/login")},i=()=>{t.push("/login?mode=register")},o=()=>{R.logout(),y.nk.success("您已成功退出登录"),t.push("/")},d=()=>{window.open("https://www.bilibili.com/video/BV1qgfmYmEAa/?share_source=copy_web&vd_source=f4167f5d5733b1b3cbdcbb4f2caa2211","_blank")},u=()=>{e.value?R.state.isAdmin?t.push("/admin"):t.push("/user"):t.push("/login")};return{isAuthenticated:e,currentUser:a,goToUserLayout:l,handleLogin:n,handleRegister:i,handleLogout:o,handleDemo:d,handleStart:u}}},V=t(3007);const x=(0,V.A)(A,[["render",h],["__scopeId","data-v-563644a7"]]);var W=x;const E={class:"login-container"},K={class:"login-form"},U={class:"form-tabs"},T={class:"verification-code-container"};var I={__name:"LoginPage",setup(e){const a=(0,s.rd)(),t=(0,s.lq)(),n=(0,F.KR)("login"),o=(0,F.KR)(),d=(0,F.Kh)({email:"",password:"",agreeToTerms:!1}),u=(0,F.KR)(),c=(0,F.Kh)({phone:"",email:"",verificationCode:"",password:"",agreeToTerms:!1}),v=(0,F.KR)(!1),m=(0,F.KR)(!1),f=(0,F.KR)(!1),p=(0,F.KR)(0);let k=null;(0,r.sV)(()=>{"register"===t.query.mode&&(n.value="register")});const g={email:[{required:!0,message:"请输入邮箱地址",trigger:"blur"},{type:"email",message:"请输入正确的邮箱地址",trigger:"blur"}],password:[{required:!0,message:"请输入密码",trigger:"blur"},{min:6,max:20,message:"密码长度在 6 到 20 个字符",trigger:"blur"}],agreeToTerms:[{validator:(e,a,t)=>{a?t():t(new Error("请阅读并同意用户协议和隐私政策"))},trigger:"change"}]},b={phone:[{required:!0,message:"请输入手机号",trigger:"blur"},{pattern:/^1[3456789]\d{9}$/,message:"请输入正确的手机号",trigger:"blur"}],email:[{required:!0,message:"请输入邮箱地址",trigger:"blur"},{type:"email",message:"请输入正确的邮箱地址",trigger:"blur"}],verificationCode:[{required:!0,message:"请输入邮箱验证码",trigger:"blur"},{len:6,message:"验证码长度应为6位",trigger:"blur"}],password:[{required:!0,message:"请输入密码",trigger:"blur"},{min:6,max:20,message:"密码长度在 6 到 20 个字符",trigger:"blur"}],agreeToTerms:[{validator:(e,a,t)=>{a?t():t(new Error("请阅读并同意用户协议和隐私政策"))},trigger:"change"}]},h=e=>{"login"===e.paneName?(u.value?.resetFields(),k&&(clearInterval(k),k=null,p.value=0)):o.value?.resetFields()},_=async()=>{const e=/^[^\s@]+@[^\s@]+\.[^\s@]+$/;if(c.email&&e.test(c.email))try{f.value=!0;const e=await R.sendVerificationCode(c.email);e.success?(y.nk.success("验证码已发送，请查收邮箱"),p.value=60,k=setInterval(()=>{p.value--,p.value<=0&&(clearInterval(k),k=null)},1e3)):y.nk.error(e.message||"发送验证码失败，请稍后重试")}catch(a){y.nk.error("发送验证码失败，请稍后重试")}finally{f.value=!1}else y.nk.error("请输入正确的邮箱地址")},w=()=>{y.nk.info("用户协议页面开发中...")},L=()=>{y.nk.info("隐私政策页面开发中...")},C=async()=>{if(o.value)try{const e=await o.value.validate();if(!e)return;v.value=!0;const t=await R.login(d);t.success?(y.nk.success("登录成功"),R.state.isAdmin?a.push("/admin"):a.push("/user")):y.nk.error(t.message||"登录失败，请检查邮箱和密码")}catch(e){y.nk.error("登录失败，请检查邮箱和密码")}finally{v.value=!1}},A=async()=>{if(u.value)try{const e=await u.value.validate();if(!e)return;m.value=!0;const a=await R.register(c);a.success?(y.nk.success("注册成功，请登录"),n.value="login",u.value.resetFields()):y.nk.error(a.message||"注册失败，请稍后重试")}catch(e){y.nk.error("注册失败，请稍后重试")}finally{m.value=!1}};return(e,a)=>{const t=(0,r.g2)("el-input"),s=(0,r.g2)("el-form-item"),k=(0,r.g2)("el-checkbox"),y=(0,r.g2)("el-button"),F=(0,r.g2)("el-form"),R=(0,r.g2)("el-tab-pane"),V=(0,r.g2)("el-tabs");return(0,r.uX)(),(0,r.CE)("div",E,[(0,r.Lk)("div",K,[a[15]||(a[15]=(0,r.Lk)("div",{class:"logo-section"},[(0,r.Lk)("h1",null,"枫叶网盘"),(0,r.Lk)("p",{class:"subtitle"},"安全、简单的个人网盘服务")],-1)),(0,r.Lk)("div",U,[(0,r.bF)(V,{modelValue:n.value,"onUpdate:modelValue":a[8]||(a[8]=e=>n.value=e),stretch:"",onTabClick:h},{default:(0,r.k6)(()=>[(0,r.bF)(R,{label:"登录",name:"login"},{default:(0,r.k6)(()=>[(0,r.bF)(F,{ref_key:"loginFormRef",ref:o,model:d,rules:g,"label-width":"0",class:"form-content"},{default:(0,r.k6)(()=>[(0,r.bF)(s,{prop:"email"},{default:(0,r.k6)(()=>[(0,r.bF)(t,{modelValue:d.email,"onUpdate:modelValue":a[0]||(a[0]=e=>d.email=e),placeholder:"邮箱地址","prefix-icon":"Message",size:"large"},null,8,["modelValue"])]),_:1}),(0,r.bF)(s,{prop:"password"},{default:(0,r.k6)(()=>[(0,r.bF)(t,{modelValue:d.password,"onUpdate:modelValue":a[1]||(a[1]=e=>d.password=e),type:"password",placeholder:"密码","prefix-icon":"Lock","show-password":"",size:"large",onKeyup:(0,l.jR)(C,["enter"])},null,8,["modelValue"])]),_:1}),(0,r.bF)(s,{prop:"agreeToTerms"},{default:(0,r.k6)(()=>[(0,r.bF)(k,{modelValue:d.agreeToTerms,"onUpdate:modelValue":a[2]||(a[2]=e=>d.agreeToTerms=e)},{default:(0,r.k6)(()=>[a[9]||(a[9]=(0,r.eW)(" 我已阅读并同意",-1)),(0,r.Lk)("a",{href:"#",onClick:(0,l.D$)(w,["prevent"])},"《用户协议》"),a[10]||(a[10]=(0,r.eW)("和",-1)),(0,r.Lk)("a",{href:"#",onClick:(0,l.D$)(L,["prevent"])},"《隐私政策》")]),_:1},8,["modelValue"])]),_:1}),(0,r.bF)(s,null,{default:(0,r.k6)(()=>[(0,r.bF)(y,{type:"primary",class:"submit-btn",loading:v.value,onClick:C,size:"large"},{default:(0,r.k6)(()=>[...a[11]||(a[11]=[(0,r.eW)(" 登录 ",-1)])]),_:1},8,["loading"])]),_:1})]),_:1},8,["model"])]),_:1}),(0,r.bF)(R,{label:"注册",name:"register"},{default:(0,r.k6)(()=>[(0,r.bF)(F,{ref_key:"registerFormRef",ref:u,model:c,rules:b,"label-width":"0",class:"form-content"},{default:(0,r.k6)(()=>[(0,r.bF)(s,{prop:"phone"},{default:(0,r.k6)(()=>[(0,r.bF)(t,{modelValue:c.phone,"onUpdate:modelValue":a[3]||(a[3]=e=>c.phone=e),placeholder:"手机号","prefix-icon":"Phone",size:"large"},null,8,["modelValue"])]),_:1}),(0,r.bF)(s,{prop:"email"},{default:(0,r.k6)(()=>[(0,r.bF)(t,{modelValue:c.email,"onUpdate:modelValue":a[4]||(a[4]=e=>c.email=e),placeholder:"邮箱地址","prefix-icon":"Message",size:"large"},null,8,["modelValue"])]),_:1}),(0,r.bF)(s,{prop:"verificationCode"},{default:(0,r.k6)(()=>[(0,r.Lk)("div",T,[(0,r.bF)(t,{modelValue:c.verificationCode,"onUpdate:modelValue":a[5]||(a[5]=e=>c.verificationCode=e),placeholder:"邮箱验证码","prefix-icon":"Key",size:"large"},null,8,["modelValue"]),(0,r.bF)(y,{type:"primary",class:"send-code-btn",disabled:f.value||p.value>0,onClick:_,size:"large"},{default:(0,r.k6)(()=>[(0,r.eW)((0,i.v_)(p.value>0?`${p.value}s后重试`:"发送验证码"),1)]),_:1},8,["disabled"])])]),_:1}),(0,r.bF)(s,{prop:"password"},{default:(0,r.k6)(()=>[(0,r.bF)(t,{modelValue:c.password,"onUpdate:modelValue":a[6]||(a[6]=e=>c.password=e),type:"password",placeholder:"密码","prefix-icon":"Lock","show-password":"",size:"large",onKeyup:(0,l.jR)(A,["enter"])},null,8,["modelValue"])]),_:1}),(0,r.bF)(s,{prop:"agreeToTerms"},{default:(0,r.k6)(()=>[(0,r.bF)(k,{modelValue:c.agreeToTerms,"onUpdate:modelValue":a[7]||(a[7]=e=>c.agreeToTerms=e)},{default:(0,r.k6)(()=>[a[12]||(a[12]=(0,r.eW)(" 我已阅读并同意",-1)),(0,r.Lk)("a",{href:"#",onClick:(0,l.D$)(w,["prevent"])},"《用户协议》"),a[13]||(a[13]=(0,r.eW)("和",-1)),(0,r.Lk)("a",{href:"#",onClick:(0,l.D$)(L,["prevent"])},"《隐私政策》")]),_:1},8,["modelValue"])]),_:1}),(0,r.bF)(s,null,{default:(0,r.k6)(()=>[(0,r.bF)(y,{type:"success",class:"submit-btn",loading:m.value,onClick:A,size:"large"},{default:(0,r.k6)(()=>[...a[14]||(a[14]=[(0,r.eW)(" 注册 ",-1)])]),_:1},8,["loading"])]),_:1})]),_:1},8,["model"])]),_:1})]),_:1},8,["modelValue"])])])])}}};const S=(0,V.A)(I,[["__scopeId","data-v-50461533"]]);var B=S;const $={class:"user-layout"},q={class:"user-header"},P={class:"header-actions"},D=["aria-expanded"],M={class:"user-avatar"},X=["src"],z={class:"user-details"},j=["title"],N={class:"dropdown-menu",role:"menu"},O={class:"user-content"},G={class:"user-content-nav","aria-label":"主导航"},Y={class:"nav-items"},Q={class:"nav-footer"},H={class:"storage-info","aria-label":"存储空间使用情况"},J=["aria-valuenow"],Z={class:"storage-text"},ee={class:"user-content-container"};var ae={__name:"UserLayout",setup(e){const a=(0,s.rd)(),t=(0,F.KR)(!1),n=()=>{t.value=!t.value},o=e=>{e.target.closest(".user-dropdown")||(t.value=!1)},d=(0,r.EW)(()=>R.state.storageInfo),u=(0,r.EW)(()=>{const{usagePercentage:e}=d.value;if(void 0!==e)return Math.min(100,Math.round(e));const{totalStorageGB:a,usedStorageGB:t}=d.value;return!a||a<=0?0:Math.min(100,Math.round(t/a*100))}),c=(0,r.EW)(()=>{const{totalStorageGB:e}=d.value;return`${(e||0).toFixed(1)} GB`}),v=(0,r.EW)(()=>{const{usedStorageGB:e}=d.value;return`${(e||0).toFixed(1)} GB`}),m=(e,a=15)=>{if(!e)return"";if(e.length<=a)return e;const t=Math.floor(a/2),l=a-t-4;return e.substring(0,t)+"****"+e.substring(e.length-l)},f=(0,r.EW)(()=>R.state.user);(0,r.wB)(f,async e=>{e&&await k()},{immediate:!1}),(0,r.wB)(()=>R.state.user,e=>{},{deep:!0,immediate:!0});const p=async()=>{try{t.value=!1,await R.logout(),a.push("/")}catch(e){R.clearUser(),a.push("/")}},k=async()=>{try{await R.fetchStorageInfo()}catch(e){}};return(0,r.sV)(async()=>{try{R.state.user||await R.fetchCurrentUser(),await k()}catch(e){await R.init()}document.addEventListener("click",o)}),(0,r.hi)(()=>{document.removeEventListener("click",o)}),(e,a)=>{const s=(0,r.g2)("router-link"),o=(0,r.g2)("router-view");return(0,r.uX)(),(0,r.CE)("div",$,[(0,r.Lk)("div",q,[a[1]||(a[1]=(0,r.Lk)("div",{class:"header-content"},[(0,r.Lk)("div",{class:"logo-container"},[(0,r.Lk)("h1",null,"枫叶网盘")])],-1)),(0,r.Lk)("div",P,[(0,r.Lk)("div",{class:(0,i.C4)(["user-dropdown",{active:t.value}])},[(0,r.Lk)("div",{class:"user-info",onClick:n,"aria-haspopup":"true","aria-expanded":t.value},[(0,r.Lk)("div",M,[(0,r.Lk)("img",{src:f.value?.avatar||"https://picsum.photos/id/1005/200/200",alt:"用户头像",class:"avatar-image"},null,8,X)]),(0,r.Lk)("div",z,[(0,r.Lk)("span",{class:"username",title:f.value?.nickname||f.value?.username||"枫叶用户"},(0,i.v_)(m(f.value?.nickname||f.value?.username||"枫叶用户")),9,j)]),(0,r.Lk)("i",{class:(0,i.C4)(["dropdown-arrow",{rotate:t.value}]),"aria-hidden":"true"},null,2)],8,D),(0,r.bF)(l.eB,{name:"dropdown"},{default:(0,r.k6)(()=>[(0,r.bo)((0,r.Lk)("div",N,[(0,r.Lk)("div",{class:"dropdown-item",onClick:p,role:"menuitem"},[...a[0]||(a[0]=[(0,r.Lk)("i",{class:"icon-logout","aria-hidden":"true"},null,-1),(0,r.Lk)("span",null,"退出登录",-1)])])],512),[[l.aG,t.value]])]),_:1})],2)])]),(0,r.Lk)("div",O,[(0,r.Lk)("nav",G,[(0,r.Lk)("div",Y,[(0,r.bF)(s,{to:"/user",class:"nav-item","active-class":"active","exact-active-class":"active","aria-label":"我的文件"},{default:(0,r.k6)(()=>[...a[2]||(a[2]=[(0,r.Lk)("i",{class:"icon-files","aria-hidden":"true"},null,-1),(0,r.Lk)("span",null,"我的文件",-1)])]),_:1}),(0,r.bF)(s,{to:"/user/dashboard",class:"nav-item","active-class":"active","aria-label":"仪表盘"},{default:(0,r.k6)(()=>[...a[3]||(a[3]=[(0,r.Lk)("i",{class:"icon-dashboard","aria-hidden":"true"},null,-1),(0,r.Lk)("span",null,"仪表盘",-1)])]),_:1}),(0,r.bF)(s,{to:"/user/shared",class:"nav-item","active-class":"active","aria-label":"共享文件"},{default:(0,r.k6)(()=>[...a[4]||(a[4]=[(0,r.Lk)("i",{class:"icon-share","aria-hidden":"true"},null,-1),(0,r.Lk)("span",null,"共享文件",-1)])]),_:1}),(0,r.bF)(s,{to:"/user/trash",class:"nav-item","active-class":"active","aria-label":"回收站"},{default:(0,r.k6)(()=>[...a[5]||(a[5]=[(0,r.Lk)("i",{class:"icon-recycle","aria-hidden":"true"},null,-1),(0,r.Lk)("span",null,"回收站",-1)])]),_:1}),a[7]||(a[7]=(0,r.Lk)("div",{class:"nav-divider",role:"separator"},null,-1)),(0,r.bF)(s,{to:"/user/settings",class:"nav-item","active-class":"active","aria-label":"设置"},{default:(0,r.k6)(()=>[...a[6]||(a[6]=[(0,r.Lk)("i",{class:"icon-settings","aria-hidden":"true"},null,-1),(0,r.Lk)("span",null,"设置",-1)])]),_:1})]),(0,r.Lk)("div",Q,[(0,r.Lk)("div",H,[(0,r.Lk)("div",{class:"storage-bar",role:"progressbar","aria-valuenow":u.value,"aria-valuemin":"0","aria-valuemax":"100"},[(0,r.Lk)("div",{class:"storage-used",style:(0,i.Tr)({width:u.value+"%"})},null,4)],8,J),(0,r.Lk)("div",Z,(0,i.v_)(v.value)+" / "+(0,i.v_)(c.value),1)])])]),(0,r.Lk)("main",ee,[(0,r.bF)(o,null,{default:(0,r.k6)(({Component:e})=>[(0,r.bF)(l.eB,{name:"fade",mode:"out-in"},{default:(0,r.k6)(()=>[((0,r.uX)(),(0,r.Wv)((0,r.$y)(e)))]),_:2},1024)]),_:1})])])])}}};const te=(0,V.A)(ae,[["__scopeId","data-v-71945168"]]);var le=te,ne=t(3489);const se={class:"admin-layout"},re={class:"admin-header"},ie={class:"header-right"},oe={class:"user-info"},de={class:"username"},ue={class:"admin-container"},ce={class:"admin-sidebar"},ve={class:"admin-main"};var me={__name:"AdminLayout",setup(e){const{proxy:a}=(0,r.nI)(),t=(0,F.KR)(!1),l=(0,s.rd)(),n=(0,s.lq)(),o=(0,r.EW)(()=>n.path),d=(0,r.EW)(()=>R.state.user?.avatar||""),u=(0,r.EW)(()=>{const e=R.state.user?.email||R.state.user?.nickname||"管理员";return e}),c=(0,F.Kh)({color:"rgba(0, 0, 0, 0.1)",fontSize:16,fontWeight:"normal"}),v=(0,F.Kh)({content:u,font:c,width:180,height:80,rotate:-20,gap:[60,60],offset:[30,30],zIndex:9999}),m=e=>{"logout"===e?(R.logout(),y.nk.success("已退出登录"),l.push("/login")):"userMode"===e&&l.push("/user")};return(0,r.sV)(async()=>{R.state.user||await R.fetchCurrentUser(),await(0,r.dY)(),t.value=!0}),(e,a)=>{const t=(0,r.g2)("el-icon"),l=(0,r.g2)("el-avatar"),n=(0,r.g2)("el-dropdown-item"),s=(0,r.g2)("el-dropdown-menu"),u=(0,r.g2)("el-dropdown"),c=(0,r.g2)("el-menu-item"),f=(0,r.g2)("el-menu"),p=(0,r.g2)("router-view"),k=(0,r.g2)("el-watermark");return(0,r.uX)(),(0,r.Wv)(k,(0,i._B)((0,r.Ng)(v)),{default:(0,r.k6)(()=>[(0,r.Lk)("div",se,[(0,r.Lk)("header",re,[a[2]||(a[2]=(0,r.Lk)("div",{class:"header-left"},[(0,r.Lk)("h1",{class:"logo"},"枫叶网盘 - 管理员控制台")],-1)),(0,r.Lk)("div",ie,[(0,r.bF)(u,{onCommand:m},{dropdown:(0,r.k6)(()=>[(0,r.bF)(s,null,{default:(0,r.k6)(()=>[(0,r.bF)(n,{command:"userMode"},{default:(0,r.k6)(()=>[...a[0]||(a[0]=[(0,r.eW)("切换到用户模式",-1)])]),_:1}),(0,r.bF)(n,{divided:"",command:"logout"},{default:(0,r.k6)(()=>[...a[1]||(a[1]=[(0,r.eW)("退出登录",-1)])]),_:1})]),_:1})]),default:(0,r.k6)(()=>[(0,r.Lk)("span",oe,[(0,r.bF)(l,{size:32,src:d.value},{default:(0,r.k6)(()=>[(0,r.bF)(t,null,{default:(0,r.k6)(()=>[(0,r.bF)((0,F.R1)(ne.User))]),_:1})]),_:1},8,["src"]),(0,r.Lk)("span",de,(0,i.v_)((0,F.R1)(R).state.user?.nickname||(0,F.R1)(R).state.user?.email||"管理员"),1),(0,r.bF)(t,{class:"el-icon--right"},{default:(0,r.k6)(()=>[(0,r.bF)((0,F.R1)(ne.ArrowDown))]),_:1})])]),_:1})])]),(0,r.Lk)("div",ue,[(0,r.Lk)("aside",ce,[(0,r.bF)(f,{"default-active":o.value,class:"admin-menu",router:"","unique-opened":""},{default:(0,r.k6)(()=>[(0,r.bF)(c,{index:"/admin"},{default:(0,r.k6)(()=>[(0,r.bF)(t,null,{default:(0,r.k6)(()=>[(0,r.bF)((0,F.R1)(ne.Monitor))]),_:1}),a[3]||(a[3]=(0,r.Lk)("span",null,"管理员仪表盘",-1))]),_:1}),(0,r.bF)(c,{index:"/admin/users"},{default:(0,r.k6)(()=>[(0,r.bF)(t,null,{default:(0,r.k6)(()=>[(0,r.bF)((0,F.R1)(ne.User))]),_:1}),a[4]||(a[4]=(0,r.Lk)("span",null,"用户管理",-1))]),_:1}),(0,r.bF)(c,{index:"/admin/system"},{default:(0,r.k6)(()=>[(0,r.bF)(t,null,{default:(0,r.k6)(()=>[(0,r.bF)((0,F.R1)(ne.Setting))]),_:1}),a[5]||(a[5]=(0,r.Lk)("span",null,"系统设置",-1))]),_:1}),(0,r.bF)(c,{index:"/admin/logs"},{default:(0,r.k6)(()=>[(0,r.bF)(t,null,{default:(0,r.k6)(()=>[(0,r.bF)((0,F.R1)(ne.Document))]),_:1}),a[6]||(a[6]=(0,r.Lk)("span",null,"操作日志",-1))]),_:1})]),_:1},8,["default-active"])]),(0,r.Lk)("main",ve,[(0,r.bF)(p)])])])]),_:1},16)}}};const fe=(0,V.A)(me,[["__scopeId","data-v-76f3bbb5"]]);var pe=fe,ke=(t(3617),t(1975),t(3242),t(9930),t(3991),t(1336),t(1558),t(7663),t(8630),t(9645),t(9858),t(8620),t(5673),t(164),t(1279),t(7849));const ge={class:"files-page"},be={class:"files-toolbar"},he={class:"toolbar-left"},ye={class:"search-container"},Fe={class:"toolbar-right"},_e={class:"header-actions"},we={class:"breadcrumb-container"},Le=["onClick"],Ce={key:0,class:"files-grid"},Re=["onClick","onContextmenu"],Ae={class:"file-icon-container"},Ve=["title"],xe={class:"file-meta"},We={class:"file-actions"},Ee={key:0,class:"empty-state"},Ke={key:1,class:"files-list"},Ue=["onClick","title"],Te={class:"upload-container"},Ie={class:"dialog-footer"},Se={class:"dialog-footer"},Be={class:"dialog-footer"};var $e={__name:"FilesPage",setup(e){(0,s.rd)();const a=(0,F.KR)("grid"),t=(0,F.KR)("name"),n=[{value:"name",label:"按名称排序"},{value:"size",label:"按大小排序"},{value:"date",label:"按修改时间排序"},{value:"type",label:"按类型排序"}],o=(0,F.KR)(""),d=(0,F.KR)([]),u=(0,F.KR)(1),c=(0,F.KR)([]),v=(0,F.KR)(1),m=(0,F.KR)(20),f=(0,F.KR)(0),p=(0,F.KR)(!1),k=(0,F.KR)(!1),g=(0,F.KR)([]),b=(0,F.KR)(!1),h=(0,F.KR)(!1),w=(0,F.Kh)({name:""}),L=(0,F.KR)(null),C={name:[{required:!0,message:"请输入文件夹名称",trigger:"blur"},{min:1,max:50,message:"长度在 1 到 50 个字符",trigger:"blur"}]},R=(0,F.KR)(!1),A=(0,F.KR)(!1),V=(0,F.Kh)({name:""}),x=(0,F.KR)(null),W={name:[{required:!0,message:"请输入新名称",trigger:"blur"},{min:1,max:50,message:"长度在 1 到 50 个字符",trigger:"blur"}]},E=(0,F.KR)(null),K=(0,F.KR)(!1),U=(0,F.KR)(!1),T=(0,F.KR)(0),I=(0,F.KR)(0),S=(0,r.EW)(()=>{let e=[...c.value];if(o.value){const a=o.value.toLowerCase();e=e.filter(e=>e.name.toLowerCase().includes(a))}return e.sort((e,a)=>{switch(t.value){case"name":return e.name.localeCompare(a.name);case"size":return a.size-e.size;case"date":return new Date(a.updatedAt)-new Date(e.updatedAt);case"type":return e.type.localeCompare(a.type);default:return 0}}),e}),B=(0,r.EW)(()=>{const e=[{name:"我的文件",path:[]}];return d.value.forEach((a,t)=>{e.push({name:a,path:d.value.slice(0,t+1)})}),e}),$=async e=>{try{if(0===e.path.length)d.value=[],u.value=1;else{const a=await _.A.get("/folder/list"),t=a.data||[];let l=1,n=1;for(const s of e.path){const e=t.find(e=>e.name===s&&(e.parentId===l||null===e.parentId&&1===l));if(!e){n=1;break}n=e.id,l=e.id}d.value=e.path,u.value=n}await q()}catch(a){y.nk.error("导航失败")}};(0,r.sV)(async()=>{await q(),document.addEventListener("click",J)}),(0,r.xo)(()=>{document.removeEventListener("click",J)});const q=async()=>{K.value=!0;try{let e=u.value;if(!e){const a=await _.A.get("/folder/root");if(!a.data||200!==a.data.code)throw new Error("获取根目录失败");e=a.data.data.id,u.value=e}const[a,t]=await Promise.all([_.A.get("/file/list/page",{params:{folderId:e,page:v.value-1,size:m.value}}),_.A.get(`/folder/${e}/subfolders`)]),l=a.data,n=l&&l.content?l.content:[],s=t.data,r=s&&200===s.code&&s.data||[],i=r.map(e=>({id:e.id,name:e.name,type:"folder",size:0,createTime:e.createTime,updateTime:e.updateTime})),o=n.map(e=>({...e,displayName:e.originalName||e.name}));c.value=[...i,...o],f.value=l&&l.totalElements?l.totalElements:0}catch(e){y.nk.error("加载文件列表失败")}finally{K.value=!1}},P=async e=>{if("folder"===e.type)try{d.value.push(e.name),u.value=e.id,await q()}catch(a){y.nk.error("进入文件夹失败")}else y.nk.warning("请下载后打开文件")},D=()=>{p.value=!0,g.value=[]},M=(e,a)=>{const t=157286400,l=a.filter(e=>e.size>t);l.length>0&&(y.nk.error(`文件大小不能超过150MB: ${l.map(e=>e.name).join(", ")}`),a=a.filter(e=>e.size<=t)),g.value=a.filter((e,a,t)=>a===t.findIndex(a=>a.name===e.name&&a.size===e.size))},X=async()=>{if(0===g.value.length)return void y.nk.warning("请选择要上传的文件");k.value=!0;let e=0,a=0;try{let l=u.value;if(!l){const e=await _.A.get("/folder/root");if(!e.data||200!==e.data.code)throw new Error("获取根目录失败");l=e.data.data.id}const n=new Set;for(const s of g.value){const r=`${s.name}_${s.size}`;if(!n.has(r))try{const a=new FormData;a.append("file",s.raw||s),a.append("folderId",l.toString()),await _.A.post("/file/upload",a,{headers:{"Content-Type":"multipart/form-data"}}),e++,n.add(r)}catch(t){a++}}0===a?y.nk.success(`成功上传 ${e} 个文件`):0===e?y.nk.error(`上传失败，共 ${a} 个文件`):y.nk.warning(`上传完成，成功 ${e} 个，失败 ${a} 个`),p.value=!1,g.value=[],await q()}catch(t){y.nk.error("上传失败")}finally{k.value=!1}},z=()=>{b.value=!0,w.name=""},j=async()=>{L.value&&await L.value.validate(async e=>{if(e){h.value=!0;try{let e=u.value;if(!e){const a=await _.A.get("/folder/root");if(!a.data.success)throw new Error("获取根目录失败");e=a.data.data.id}await _.A.post("/folder/create",{name:w.name,parentId:e}),y.nk.success("文件夹创建成功"),b.value=!1,await q()}catch(a){y.nk.error("创建文件夹失败")}finally{h.value=!1}}})},N=async(e,a)=>{switch(E.value=a,e){case"download":try{const e=await _.A.get(`/file/${a.id}/download`,{responseType:"blob"}),t=window.URL.createObjectURL(new Blob([e.data])),l=document.createElement("a");l.href=t,l.setAttribute("download",a.name),document.body.appendChild(l),l.click(),document.body.removeChild(l),window.URL.revokeObjectURL(t),y.nk.success(`下载完成: ${a.name}`)}catch(t){y.nk.error("下载失败")}break;case"share":try{await _.A.post("/share/create",{targetId:a.id,targetType:"folder"===a.type?"folder":"file",shareType:0,password:null,expireTime:null});O("感谢使用LeafPan，这是一个简单高效的云存储平台")}catch(t){y.nk.error("分享失败")}break;case"rename":R.value=!0,V.name=a.originalName||a.name;break;case"move":y.nk.info(`移动文件: ${a.name}`),await new Promise(e=>setTimeout(e,1e3)),y.nk.success("文件移动成功");break;case"copy":y.nk.info(`复制文件: ${a.name}`),await new Promise(e=>setTimeout(e,1e3)),y.nk.success("文件复制成功");break;case"delete":try{await ke.s.confirm(`确定要删除 "${a.originalName}" 吗？此操作不可恢复。`,"确认删除",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}),"folder"===a.type?await _.A.delete(`/folder/${a.id}`):await _.A.delete(`/file/${a.id}`),y.nk.success("删除成功"),await q()}catch(t){"cancel"!==t&&y.nk.error("删除失败")}break}};async function O(e){try{return await navigator.clipboard.writeText(e),y.nk.success("分享链接已复制"),!0}catch(a){return y.nk.error("分享链接复制失败"),!1}}const G=async()=>{x.value&&await x.value.validate(async e=>{if(e){A.value=!0;try{const e=E.value;"folder"===e.type?await _.A.put(`/folder/${e.id}/rename`,{name:V.name}):await _.A.put(`/file/${e.id}/rename`,{name:V.name}),y.nk.success("重命名成功"),R.value=!1,await q()}catch(a){y.nk.error("重命名失败")}finally{A.value=!1}}})},Y=e=>{t.value=e},Q=(e,a)=>{E.value=e,T.value=a.clientX,I.value=a.clientY,U.value=!0},H=(e,a,t)=>{t.preventDefault(),E.value=e,T.value=t.clientX,I.value=t.clientY,U.value=!0},J=()=>{U.value=!1},Z=e=>{J(),N(e,E.value)},ee=e=>{const a={folder:"Folder",image:"Picture",video:"VideoPlay",audio:"Headset",document:"Document",archive:"Files",spreadsheet:"DataLine",default:"Document"};return a[e]||a.default},ae=e=>{if(0===e)return"0 B";const a=1024,t=["B","KB","MB","GB","TB"],l=Math.floor(Math.log(e)/Math.log(a));return parseFloat((e/Math.pow(a,l)).toFixed(2))+" "+t[l]},te=e=>{if(!e||"Invalid Date"===e)return"--";const a=new Date(e);return isNaN(a.getTime())?"--":a.toLocaleDateString("zh-CN")+" "+a.toLocaleTimeString("zh-CN",{hour:"2-digit",minute:"2-digit"})},le=e=>{if(!e)return"";const t="grid"===a.value?10:25;return e.length<=t?e:e.substring(0,t)+"..."};return(e,s)=>{const d=(0,r.g2)("el-icon"),u=(0,r.g2)("el-button"),c=(0,r.g2)("el-button-group"),v=(0,r.g2)("el-divider"),m=(0,r.g2)("el-input"),f=(0,r.g2)("el-dropdown-item"),y=(0,r.g2)("el-dropdown-menu"),_=(0,r.g2)("el-dropdown"),E=(0,r.g2)("el-breadcrumb-item"),q=(0,r.g2)("el-breadcrumb"),O=(0,r.g2)("el-empty"),J=(0,r.g2)("el-table-column"),se=(0,r.g2)("el-table"),re=(0,r.g2)("el-upload"),ie=(0,r.g2)("el-dialog"),oe=(0,r.g2)("el-form-item"),de=(0,r.g2)("el-form"),ue=(0,r.g2)("el-menu-item"),ce=(0,r.g2)("el-menu"),ve=(0,r.gN)("loading");return(0,r.uX)(),(0,r.CE)("div",ge,[(0,r.Lk)("div",be,[(0,r.Lk)("div",he,[(0,r.bF)(c,{class:"view-toggle"},{default:(0,r.k6)(()=>[(0,r.bF)(u,{class:(0,i.C4)({"active-view":"grid"===a.value}),onClick:s[0]||(s[0]=e=>a.value="grid"),title:"网格视图"},{default:(0,r.k6)(()=>[(0,r.bF)(d,null,{default:(0,r.k6)(()=>[(0,r.bF)((0,F.R1)(ne.Grid))]),_:1})]),_:1},8,["class"]),(0,r.bF)(u,{class:(0,i.C4)({"active-view":"list"===a.value}),onClick:s[1]||(s[1]=e=>a.value="list"),title:"列表视图"},{default:(0,r.k6)(()=>[(0,r.bF)(d,null,{default:(0,r.k6)(()=>[(0,r.bF)((0,F.R1)(ne.List))]),_:1})]),_:1},8,["class"])]),_:1}),(0,r.bF)(v,{direction:"vertical",class:"toolbar-divider"}),(0,r.Lk)("div",ye,[(0,r.bF)(m,{modelValue:o.value,"onUpdate:modelValue":s[2]||(s[2]=e=>o.value=e),placeholder:"搜索文件...",class:"search-input",clearable:""},{prefix:(0,r.k6)(()=>[(0,r.bF)(d,null,{default:(0,r.k6)(()=>[(0,r.bF)((0,F.R1)(ne.Search))]),_:1})]),_:1},8,["modelValue"])])]),(0,r.Lk)("div",Fe,[(0,r.Lk)("div",_e,[(0,r.bF)(u,{type:"primary",class:"modern-btn",onClick:D},{default:(0,r.k6)(()=>[(0,r.bF)(d,null,{default:(0,r.k6)(()=>[(0,r.bF)((0,F.R1)(ne.Upload))]),_:1}),s[12]||(s[12]=(0,r.eW)(" 上传文件 ",-1))]),_:1}),(0,r.bF)(u,{disabled:!0,class:"modern-btn",onClick:z},{default:(0,r.k6)(()=>[...s[13]||(s[13]=[(0,r.eW)(" 新建文件夹 ",-1)])]),_:1})]),(0,r.bF)(_,{onCommand:Y,class:"sort-dropdown"},{dropdown:(0,r.k6)(()=>[(0,r.bF)(y,null,{default:(0,r.k6)(()=>[((0,r.uX)(),(0,r.CE)(r.FK,null,(0,r.pI)(n,e=>(0,r.bF)(f,{key:e.value,command:e.value,class:(0,i.C4)({"active-sort":t.value===e.value})},{default:(0,r.k6)(()=>[(0,r.eW)((0,i.v_)(e.label),1)]),_:2},1032,["command","class"])),64))]),_:1})]),default:(0,r.k6)(()=>[(0,r.bF)(u,{class:"sort-button"},{default:(0,r.k6)(()=>[(0,r.eW)((0,i.v_)(n.find(e=>e.value===t.value)?.label)+" ",1),(0,r.bF)(d,{class:"el-icon--right"},{default:(0,r.k6)(()=>[(0,r.bF)((0,F.R1)(ne.ArrowDown))]),_:1})]),_:1})]),_:1})])]),(0,r.Lk)("div",we,[(0,r.bF)(q,{separator:"/",class:"modern-breadcrumb"},{default:(0,r.k6)(()=>[((0,r.uX)(!0),(0,r.CE)(r.FK,null,(0,r.pI)(B.value,(e,a)=>((0,r.uX)(),(0,r.Wv)(E,{key:a},{default:(0,r.k6)(()=>[(0,r.Lk)("a",{onClick:a=>$(e),class:"breadcrumb-link"},(0,i.v_)(e.name),9,Le)]),_:2},1024))),128))]),_:1})]),"grid"===a.value?(0,r.bo)(((0,r.uX)(),(0,r.CE)("div",Ce,[((0,r.uX)(!0),(0,r.CE)(r.FK,null,(0,r.pI)(S.value,e=>((0,r.uX)(),(0,r.CE)("div",{key:e.id,class:"file-item",onClick:a=>P(e),onContextmenu:(0,l.D$)(a=>Q(e,a),["prevent"])},[(0,r.Lk)("div",Ae,[(0,r.bF)(d,{class:"file-icon"},{default:(0,r.k6)(()=>[((0,r.uX)(),(0,r.Wv)((0,r.$y)(ee(e.type))))]),_:2},1024)]),(0,r.Lk)("div",{class:"file-name",title:e.originalName||e.name},(0,i.v_)(le(e.originalName||e.name)),9,Ve),(0,r.Lk)("div",xe,(0,i.v_)("folder"===e.type?"":ae(e.size)),1),(0,r.Lk)("div",We,[(0,r.bF)(_,{onCommand:a=>N(a,e)},{dropdown:(0,r.k6)(()=>[(0,r.bF)(y,null,{default:(0,r.k6)(()=>[(0,r.bF)(f,{command:"download"},{default:(0,r.k6)(()=>[(0,r.bF)(d,null,{default:(0,r.k6)(()=>[(0,r.bF)((0,F.R1)(ne.Download))]),_:1}),s[14]||(s[14]=(0,r.eW)(" 下载 ",-1))]),_:1}),(0,r.bF)(f,{command:"share"},{default:(0,r.k6)(()=>[(0,r.bF)(d,null,{default:(0,r.k6)(()=>[(0,r.bF)((0,F.R1)(ne.Share))]),_:1}),s[15]||(s[15]=(0,r.eW)(" 分享 ",-1))]),_:1}),(0,r.bF)(f,{command:"rename"},{default:(0,r.k6)(()=>[(0,r.bF)(d,null,{default:(0,r.k6)(()=>[(0,r.bF)((0,F.R1)(ne.Edit))]),_:1}),s[16]||(s[16]=(0,r.eW)(" 重命名 ",-1))]),_:1}),(0,r.bF)(f,{command:"move"},{default:(0,r.k6)(()=>[(0,r.bF)(d,null,{default:(0,r.k6)(()=>[(0,r.bF)((0,F.R1)(ne.Position))]),_:1}),s[17]||(s[17]=(0,r.eW)(" 移动 ",-1))]),_:1}),(0,r.bF)(f,{command:"copy"},{default:(0,r.k6)(()=>[(0,r.bF)(d,null,{default:(0,r.k6)(()=>[(0,r.bF)((0,F.R1)(ne.CopyDocument))]),_:1}),s[18]||(s[18]=(0,r.eW)(" 复制 ",-1))]),_:1}),(0,r.bF)(f,{command:"delete",divided:"",class:"danger-item"},{default:(0,r.k6)(()=>[(0,r.bF)(d,null,{default:(0,r.k6)(()=>[(0,r.bF)((0,F.R1)(ne.Delete))]),_:1}),s[19]||(s[19]=(0,r.eW)(" 删除 ",-1))]),_:1})]),_:1})]),default:(0,r.k6)(()=>[(0,r.bF)(u,{type:"text",size:"small",class:"file-action-btn",onClick:s[3]||(s[3]=(0,l.D$)(()=>{},["stop"]))},{default:(0,r.k6)(()=>[(0,r.bF)(d,null,{default:(0,r.k6)(()=>[(0,r.bF)((0,F.R1)(ne.More))]),_:1})]),_:1})]),_:1},8,["onCommand"])])],40,Re))),128)),0===S.value.length?((0,r.uX)(),(0,r.CE)("div",Ee,[(0,r.bF)(O,{description:"暂无文件"})])):(0,r.Q3)("",!0)])),[[ve,K.value]]):(0,r.bo)(((0,r.uX)(),(0,r.CE)("div",Ke,[(0,r.bF)(se,{data:S.value,class:"modern-table",onRowContextmenu:H,stripe:""},{default:(0,r.k6)(()=>[(0,r.bF)(J,{width:"50"},{default:(0,r.k6)(({row:e})=>[(0,r.bF)(d,{class:"table-file-icon"},{default:(0,r.k6)(()=>[((0,r.uX)(),(0,r.Wv)((0,r.$y)(ee(e.type))))]),_:2},1024)]),_:1}),(0,r.bF)(J,{label:"名称","min-width":"300"},{default:(0,r.k6)(({row:e})=>[(0,r.Lk)("span",{class:"file-name",onClick:a=>P(e),title:e.originalName||e.name},(0,i.v_)(le(e.originalName||e.name)),9,Ue)]),_:1}),(0,r.bF)(J,{label:"大小",width:"120"},{default:(0,r.k6)(({row:e})=>[(0,r.eW)((0,i.v_)("folder"===e.type?"-":ae(e.size)),1)]),_:1}),(0,r.bF)(J,{label:"修改时间",width:"180"},{default:(0,r.k6)(({row:e})=>[(0,r.eW)((0,i.v_)(te(e.updatedAt)),1)]),_:1}),(0,r.bF)(J,{label:"操作",width:"180"},{default:(0,r.k6)(({row:e})=>[(0,r.bF)(u,{type:"text",class:"table-action-btn",onClick:a=>N("download",e)},{default:(0,r.k6)(()=>[(0,r.bF)(d,null,{default:(0,r.k6)(()=>[(0,r.bF)((0,F.R1)(ne.Download))]),_:1})]),_:1},8,["onClick"]),(0,r.bF)(u,{type:"text",class:"table-action-btn",onClick:a=>N("share",e)},{default:(0,r.k6)(()=>[(0,r.bF)(d,null,{default:(0,r.k6)(()=>[(0,r.bF)((0,F.R1)(ne.Share))]),_:1})]),_:1},8,["onClick"]),(0,r.bF)(u,{type:"text",class:"table-action-btn",onClick:a=>N("rename",e)},{default:(0,r.k6)(()=>[(0,r.bF)(d,null,{default:(0,r.k6)(()=>[(0,r.bF)((0,F.R1)(ne.Edit))]),_:1})]),_:1},8,["onClick"]),(0,r.bF)(_,{onCommand:a=>N(a,e)},{dropdown:(0,r.k6)(()=>[(0,r.bF)(y,null,{default:(0,r.k6)(()=>[(0,r.bF)(f,{command:"move"},{default:(0,r.k6)(()=>[(0,r.bF)(d,null,{default:(0,r.k6)(()=>[(0,r.bF)((0,F.R1)(ne.Position))]),_:1}),s[20]||(s[20]=(0,r.eW)(" 移动 ",-1))]),_:1}),(0,r.bF)(f,{command:"copy"},{default:(0,r.k6)(()=>[(0,r.bF)(d,null,{default:(0,r.k6)(()=>[(0,r.bF)((0,F.R1)(ne.CopyDocument))]),_:1}),s[21]||(s[21]=(0,r.eW)(" 复制 ",-1))]),_:1}),(0,r.bF)(f,{command:"delete",divided:"",class:"danger-item"},{default:(0,r.k6)(()=>[(0,r.bF)(d,null,{default:(0,r.k6)(()=>[(0,r.bF)((0,F.R1)(ne.Delete))]),_:1}),s[22]||(s[22]=(0,r.eW)(" 删除 ",-1))]),_:1})]),_:1})]),default:(0,r.k6)(()=>[(0,r.bF)(u,{type:"text",class:"table-action-btn"},{default:(0,r.k6)(()=>[(0,r.bF)(d,null,{default:(0,r.k6)(()=>[(0,r.bF)((0,F.R1)(ne.More))]),_:1})]),_:1})]),_:1},8,["onCommand"])]),_:1})]),_:1},8,["data"])])),[[ve,K.value]]),(0,r.bF)(ie,{modelValue:p.value,"onUpdate:modelValue":s[5]||(s[5]=e=>p.value=e),title:"上传文件",width:"500px",class:"modern-dialog"},{footer:(0,r.k6)(()=>[(0,r.Lk)("span",Ie,[(0,r.bF)(u,{onClick:s[4]||(s[4]=e=>p.value=!1)},{default:(0,r.k6)(()=>[...s[24]||(s[24]=[(0,r.eW)("取消",-1)])]),_:1}),(0,r.bF)(u,{type:"primary",onClick:X,loading:k.value,class:"modern-btn"},{default:(0,r.k6)(()=>[...s[25]||(s[25]=[(0,r.eW)(" 上传 ",-1)])]),_:1},8,["loading"])])]),default:(0,r.k6)(()=>[(0,r.Lk)("div",Te,[(0,r.bF)(re,{class:"upload-area",drag:"",action:"#","auto-upload":!1,"on-change":M,"file-list":g.value,multiple:""},{default:(0,r.k6)(()=>[(0,r.bF)(d,{class:"upload-icon"},{default:(0,r.k6)(()=>[(0,r.bF)((0,F.R1)(ne.Upload))]),_:1}),s[23]||(s[23]=(0,r.Lk)("div",{class:"el-upload__text"},[(0,r.eW)(" 将文件拖到此处，或"),(0,r.Lk)("em",null,"点击选择文件")],-1))]),_:1},8,["file-list"])])]),_:1},8,["modelValue"]),(0,r.bF)(ie,{modelValue:b.value,"onUpdate:modelValue":s[8]||(s[8]=e=>b.value=e),title:"新建文件夹",width:"400px",class:"modern-dialog"},{footer:(0,r.k6)(()=>[(0,r.Lk)("span",Se,[(0,r.bF)(u,{onClick:s[7]||(s[7]=e=>b.value=!1)},{default:(0,r.k6)(()=>[...s[26]||(s[26]=[(0,r.eW)("取消",-1)])]),_:1}),(0,r.bF)(u,{type:"primary",onClick:j,loading:h.value,class:"modern-btn"},{default:(0,r.k6)(()=>[...s[27]||(s[27]=[(0,r.eW)(" 创建 ",-1)])]),_:1},8,["loading"])])]),default:(0,r.k6)(()=>[(0,r.bF)(de,{model:w,rules:C,ref_key:"folderFormRef",ref:L},{default:(0,r.k6)(()=>[(0,r.bF)(oe,{label:"文件夹名称",prop:"name"},{default:(0,r.k6)(()=>[(0,r.bF)(m,{modelValue:w.name,"onUpdate:modelValue":s[6]||(s[6]=e=>w.name=e),placeholder:"请输入文件夹名称",class:"modern-input"},null,8,["modelValue"])]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue"]),(0,r.bF)(ie,{modelValue:R.value,"onUpdate:modelValue":s[11]||(s[11]=e=>R.value=e),title:"重命名",width:"400px",class:"modern-dialog"},{footer:(0,r.k6)(()=>[(0,r.Lk)("span",Be,[(0,r.bF)(u,{onClick:s[10]||(s[10]=e=>R.value=!1)},{default:(0,r.k6)(()=>[...s[28]||(s[28]=[(0,r.eW)("取消",-1)])]),_:1}),(0,r.bF)(u,{type:"primary",onClick:G,loading:A.value,class:"modern-btn"},{default:(0,r.k6)(()=>[...s[29]||(s[29]=[(0,r.eW)(" 确定 ",-1)])]),_:1},8,["loading"])])]),default:(0,r.k6)(()=>[(0,r.bF)(de,{model:V,rules:W,ref_key:"renameFormRef",ref:x},{default:(0,r.k6)(()=>[(0,r.bF)(oe,{label:"新名称",prop:"name"},{default:(0,r.k6)(()=>[(0,r.bF)(m,{modelValue:V.name,"onUpdate:modelValue":s[9]||(s[9]=e=>V.name=e),placeholder:"请输入新名称",class:"modern-input"},null,8,["modelValue"])]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue"]),U.value?((0,r.uX)(),(0,r.Wv)(ce,{key:2,class:"context-menu modern-context-menu",style:(0,i.Tr)({left:T.value+"px",top:I.value+"px"}),onSelect:Z},{default:(0,r.k6)(()=>[(0,r.bF)(ue,{index:"download"},{default:(0,r.k6)(()=>[(0,r.bF)(d,null,{default:(0,r.k6)(()=>[(0,r.bF)((0,F.R1)(ne.Download))]),_:1}),s[30]||(s[30]=(0,r.Lk)("span",null,"下载",-1))]),_:1}),(0,r.bF)(ue,{index:"share"},{default:(0,r.k6)(()=>[(0,r.bF)(d,null,{default:(0,r.k6)(()=>[(0,r.bF)((0,F.R1)(ne.Share))]),_:1}),s[31]||(s[31]=(0,r.Lk)("span",null,"分享",-1))]),_:1}),(0,r.bF)(ue,{index:"rename"},{default:(0,r.k6)(()=>[(0,r.bF)(d,null,{default:(0,r.k6)(()=>[(0,r.bF)((0,F.R1)(ne.Edit))]),_:1}),s[32]||(s[32]=(0,r.Lk)("span",null,"重命名",-1))]),_:1}),(0,r.bF)(ue,{index:"move"},{default:(0,r.k6)(()=>[(0,r.bF)(d,null,{default:(0,r.k6)(()=>[(0,r.bF)((0,F.R1)(ne.Position))]),_:1}),s[33]||(s[33]=(0,r.Lk)("span",null,"移动",-1))]),_:1}),(0,r.bF)(ue,{index:"copy"},{default:(0,r.k6)(()=>[(0,r.bF)(d,null,{default:(0,r.k6)(()=>[(0,r.bF)((0,F.R1)(ne.CopyDocument))]),_:1}),s[34]||(s[34]=(0,r.Lk)("span",null,"复制",-1))]),_:1}),(0,r.bF)(ue,{index:"delete",divided:"",class:"danger-item"},{default:(0,r.k6)(()=>[(0,r.bF)(d,null,{default:(0,r.k6)(()=>[(0,r.bF)((0,F.R1)(ne.Delete))]),_:1}),s[35]||(s[35]=(0,r.Lk)("span",null,"删除",-1))]),_:1})]),_:1},8,["style"])):(0,r.Q3)("",!0)])}}};const qe=(0,V.A)($e,[["__scopeId","data-v-bd379b88"]]);var Pe=qe;const De={class:"dashboard-page"},Me={class:"storage-card"},Xe={class:"storage-info"},ze={class:"storage-chart"},je={class:"circular-progress"},Ne={viewBox:"0 0 100 100"},Oe=["stroke-dashoffset"],Ge={x:"50",y:"50","text-anchor":"middle",dy:"0.3em","font-size":"20","font-weight":"bold",fill:"#303133"},Ye={class:"storage-details"},Qe={class:"storage-item"},He={class:"value"},Je={class:"storage-item"},Ze={class:"value"},ea={class:"storage-item"},aa={class:"value"},ta={class:"stats-grid"},la={class:"stat-content"};var na={__name:"DashboardPage",setup(e){const a=(0,F.KR)(1),t=(0,F.KR)(0),l=(0,F.KR)(!1),n=(0,r.EW)(()=>Math.min(100,Math.round(t.value/a.value*100))),s=(0,r.EW)(()=>{const e=2*Math.PI*45;return e-n.value/100*e}),o=(0,r.EW)(()=>1024*a.value*1024*1024),d=(0,r.EW)(()=>1024*t.value*1024*1024),u=(0,r.EW)(()=>o.value-d.value),c=(0,F.KR)([{type:"files",label:"文件总数",count:0},{type:"folders",label:"文件夹",count:0},{type:"shared",label:"共享文件",count:0},{type:"favorites",label:"收藏文件",count:0}]),v=async()=>{try{l.value=!0;const e=await _.A.get("/user/storage");if(e.data&&e.data.data){const l=e.data.data;a.value=l.storageQuota/1073741824,t.value=l.usedStorage/1073741824}else if(e.data&&e.data.availableStorage){const l=e.data;a.value=l.storageQuota/1073741824,t.value=l.usedStorage/1073741824}}catch(e){a.value=1,t.value=0}finally{l.value=!1}},m=async()=>{try{const[e,a]=await Promise.all([_.A.get("/file/list/page",{params:{page:0,size:1}}),_.A.get("/folder/list")]),t=e.data?.totalElements||0,l=a.data?.data?.length||0;c.value=[{type:"files",label:"文件总数",count:t},{type:"folders",label:"文件夹",count:l},{type:"shared",label:"共享文件",count:0},{type:"favorites",label:"收藏文件",count:0}]}catch(e){c.value=[{type:"files",label:"文件总数",count:0},{type:"folders",label:"文件夹",count:0},{type:"shared",label:"共享文件",count:0},{type:"favorites",label:"收藏文件",count:0}]}};return(0,r.sV)(async()=>{await Promise.all([v(),m()])}),(e,a)=>((0,r.uX)(),(0,r.CE)("div",De,[(0,r.Lk)("div",Me,[a[4]||(a[4]=(0,r.Lk)("div",{class:"storage-card-header"},[(0,r.Lk)("h2",null,"存储空间")],-1)),(0,r.Lk)("div",Xe,[(0,r.Lk)("div",ze,[(0,r.Lk)("div",je,[((0,r.uX)(),(0,r.CE)("svg",Ne,[a[0]||(a[0]=(0,r.Lk)("circle",{cx:"50",cy:"50",r:"45",fill:"none",stroke:"#e9ecef","stroke-width":"10"},null,-1)),(0,r.Lk)("circle",{cx:"50",cy:"50",r:"45",fill:"none",stroke:"#409EFF","stroke-width":"10","stroke-dasharray":"283","stroke-dashoffset":s.value,"stroke-linecap":"round",transform:"rotate(-90 50 50)"},null,8,Oe),(0,r.Lk)("text",Ge,(0,i.v_)(n.value)+"% ",1)]))]),(0,r.Lk)("div",Ye,[(0,r.Lk)("div",Qe,[a[1]||(a[1]=(0,r.Lk)("span",{class:"label"},"已使用",-1)),(0,r.Lk)("span",He,(0,i.v_)((0,F.R1)(w.v7)(d.value)),1)]),(0,r.Lk)("div",Je,[a[2]||(a[2]=(0,r.Lk)("span",{class:"label"},"总容量",-1)),(0,r.Lk)("span",Ze,(0,i.v_)((0,F.R1)(w.v7)(o.value)),1)]),(0,r.Lk)("div",ea,[a[3]||(a[3]=(0,r.Lk)("span",{class:"label"},"可用空间",-1)),(0,r.Lk)("span",aa,(0,i.v_)((0,F.R1)(w.v7)(u.value)),1)])])])])]),(0,r.Lk)("div",ta,[((0,r.uX)(!0),(0,r.CE)(r.FK,null,(0,r.pI)(c.value,e=>((0,r.uX)(),(0,r.CE)("div",{class:"stat-card",key:e.type},[(0,r.Lk)("div",la,[(0,r.Lk)("h3",null,(0,i.v_)(e.count),1),(0,r.Lk)("p",null,(0,i.v_)(e.label),1)])]))),128))])]))}};const sa=(0,V.A)(na,[["__scopeId","data-v-c32ff378"]]);var ra=sa;t(9217);const ia={class:"shared-page"},oa={class:"tab-header"},da={class:"search-bar"},ua={class:"tab-actions"},ca={key:0,class:"shared-files-list"},va={class:"file-info"},ma={class:"file-name"},fa={class:"file-meta"},pa={class:"meta-item"},ka={class:"meta-item"},ga={class:"meta-item"},ba={class:"file-actions"},ha={key:1,class:"empty-state"},ya={class:"tab-header"},Fa={class:"search-bar"},_a={key:0,class:"shared-files-list"},wa={class:"file-info"},La={class:"file-name"},Ca={class:"file-meta"},Ra={class:"meta-item"},Aa={class:"meta-item"},Va={class:"meta-item"},xa={class:"file-actions"},Wa={key:1,class:"empty-state"},Ea={class:"dialog-footer"};var Ka={__name:"SharedPage",setup(e){const a=(0,F.KR)("sharedByMe"),t=(0,F.KR)(""),l=(0,F.KR)(""),n=(0,F.KR)([]),s=(0,F.KR)([]),o=(0,F.KR)([]),d=(0,F.KR)([]),u=(0,F.KR)(!1),c=(0,F.KR)("新建共享"),v=(0,F.KR)(null),m=(0,F.KR)(!1),f=(0,F.KR)(!1),p=(0,F.KR)({id:null,fileId:"",sharedTo:[],permission:"read",expiresAt:null}),k={fileId:[{required:!0,message:"请选择要共享的文件",trigger:"change"}],sharedTo:[{required:!0,message:"请选择共享用户",trigger:"change"}],permission:[{required:!0,message:"请选择权限",trigger:"change"}]},g=(0,r.EW)(()=>{if(!t.value)return n.value;const e=t.value.toLowerCase();return n.value.filter(a=>a.name.toLowerCase().includes(e)||a.sharedTo.some(a=>a.toLowerCase().includes(e)))}),b=(0,r.EW)(()=>{if(!l.value)return s.value;const e=l.value.toLowerCase();return s.value.filter(a=>a.name.toLowerCase().includes(e)||a.sharedBy.toLowerCase().includes(e))}),h=e=>{const a={folder:"el-icon-folder",image:"el-icon-picture",video:"el-icon-film",audio:"el-icon-headset",pdf:"el-icon-document",document:"el-icon-document",archive:"el-icon-folder-opened",code:"el-icon-document-copy",other:"el-icon-document"};return a[e]||a.other},L=e=>{const a={folder:"folder-icon",image:"image-icon",video:"video-icon",audio:"audio-icon",pdf:"pdf-icon",document:"document-icon",archive:"archive-icon",code:"code-icon",other:"other-icon"};return a[e]||a.other},C=()=>{"sharedByMe"===a.value?t.value="":l.value=""},R=()=>{},A=()=>{},V=()=>{f.value=!1,c.value="新建共享",p.value={id:null,fileId:"",sharedTo:[],permission:"read",expiresAt:null},u.value=!0},x=e=>{f.value=!0,c.value="编辑共享",p.value={id:e.id,fileId:e.fileId,sharedTo:e.sharedTo,permission:e.permission,expiresAt:e.expiresAt},u.value=!0},W=e=>{ke.s.confirm(`确定要停止共享 "${e.name}" 吗？`,"确认停止共享",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(async()=>{try{await _.A.delete(`/share/${e.id}`),y.nk.success("已停止共享"),await I()}catch(a){y.nk.error("停止共享失败")}}).catch(()=>{})},E=async e=>{try{const a=await _.A.get(`/file/${e.fileId}/download`,{responseType:"blob"}),t=window.URL.createObjectURL(new Blob([a.data])),l=document.createElement("a");l.href=t,l.setAttribute("download",e.name),document.body.appendChild(l),l.click(),document.body.removeChild(l),window.URL.revokeObjectURL(t),y.nk.success(`开始下载 "${e.name}"`)}catch(a){y.nk.error("下载失败")}},K=e=>{y.nk.info(`查看文件 "${e.name}"`)},U=e=>{ke.s.confirm(`确定要从您的共享列表中移除 "${e.name}" 吗？`,"确认移除",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(async()=>{try{await _.A.delete(`/share/${e.id}`),y.nk.success("已移除共享"),await S()}catch(a){y.nk.error("移除共享失败")}}).catch(()=>{})},T=async()=>{if(v.value)try{await v.value.validate(),m.value=!0,f.value?(await _.A.put(`/share/${p.value.id}`,p.value),y.nk.success("共享已更新"),await I()):(await _.A.post("/share/create",p.value),y.nk.success("共享已创建"),await I()),u.value=!1}catch(e){!1!==e&&y.nk.error(f.value?"更新共享失败":"创建共享失败")}finally{m.value=!1}},I=async()=>{try{const e=await _.A.get("/share/user");n.value=e.data||[]}catch(e){}},S=async()=>{try{const e=await _.A.get("/share/shared-with-me");s.value=e.data||[]}catch(e){}},B=async()=>{try{const e=await _.A.get("/file/list");o.value=e.data||[]}catch(e){}},$=async()=>{try{const e=await _.A.get("/user/list");d.value=e.data||[]}catch(e){d.value=[]}};return(0,r.sV)(async()=>{await Promise.all([I(),S(),B(),$()])}),(e,n)=>{const s=(0,r.g2)("el-input"),f=(0,r.g2)("el-button"),y=(0,r.g2)("el-empty"),_=(0,r.g2)("el-tab-pane"),I=(0,r.g2)("el-tabs"),S=(0,r.g2)("el-option"),B=(0,r.g2)("el-select"),$=(0,r.g2)("el-form-item"),q=(0,r.g2)("el-radio"),P=(0,r.g2)("el-radio-group"),D=(0,r.g2)("el-date-picker"),M=(0,r.g2)("el-form"),X=(0,r.g2)("el-dialog");return(0,r.uX)(),(0,r.CE)("div",ia,[(0,r.bF)(I,{modelValue:a.value,"onUpdate:modelValue":n[2]||(n[2]=e=>a.value=e),class:"shared-tabs",onTabClick:C},{default:(0,r.k6)(()=>[(0,r.bF)(_,{label:"我共享的",name:"sharedByMe"},{default:(0,r.k6)(()=>[(0,r.Lk)("div",oa,[(0,r.Lk)("div",da,[(0,r.bF)(s,{modelValue:t.value,"onUpdate:modelValue":n[0]||(n[0]=e=>t.value=e),placeholder:"搜索共享文件...","prefix-icon":"el-icon-search",clearable:"",onInput:R},null,8,["modelValue"])]),(0,r.Lk)("div",ua,[(0,r.bF)(f,{type:"primary",onClick:V},{default:(0,r.k6)(()=>[...n[9]||(n[9]=[(0,r.eW)("新建共享",-1)])]),_:1})])]),g.value.length>0?((0,r.uX)(),(0,r.CE)("div",ca,[((0,r.uX)(!0),(0,r.CE)(r.FK,null,(0,r.pI)(g.value,e=>((0,r.uX)(),(0,r.CE)("div",{class:"file-item",key:e.id},[(0,r.Lk)("div",{class:(0,i.C4)(["file-icon",L(e.type)])},[(0,r.Lk)("i",{class:(0,i.C4)(h(e.type))},null,2)],2),(0,r.Lk)("div",va,[(0,r.Lk)("div",ma,(0,i.v_)(e.name),1),(0,r.Lk)("div",fa,[(0,r.Lk)("span",pa,"共享给: "+(0,i.v_)(e.sharedTo.join(", ")),1),(0,r.Lk)("span",ka,"共享时间: "+(0,i.v_)((0,F.R1)(w.Yq)(e.sharedAt)),1),(0,r.Lk)("span",ga,"权限: "+(0,i.v_)("read"===e.permission?"只读":"读写"),1)])]),(0,r.Lk)("div",ba,[(0,r.bF)(f,{type:"text",onClick:a=>x(e)},{default:(0,r.k6)(()=>[...n[10]||(n[10]=[(0,r.eW)("编辑",-1)])]),_:1},8,["onClick"]),(0,r.bF)(f,{type:"text",onClick:a=>W(e)},{default:(0,r.k6)(()=>[...n[11]||(n[11]=[(0,r.eW)("停止共享",-1)])]),_:1},8,["onClick"])])]))),128))])):((0,r.uX)(),(0,r.CE)("div",ha,[(0,r.bF)(y,{description:"暂无共享文件"})]))]),_:1}),(0,r.bF)(_,{label:"与我共享",name:"sharedWithMe"},{default:(0,r.k6)(()=>[(0,r.Lk)("div",ya,[(0,r.Lk)("div",Fa,[(0,r.bF)(s,{modelValue:l.value,"onUpdate:modelValue":n[1]||(n[1]=e=>l.value=e),placeholder:"搜索共享文件...","prefix-icon":"el-icon-search",clearable:"",onInput:A},null,8,["modelValue"])])]),b.value.length>0?((0,r.uX)(),(0,r.CE)("div",_a,[((0,r.uX)(!0),(0,r.CE)(r.FK,null,(0,r.pI)(b.value,e=>((0,r.uX)(),(0,r.CE)("div",{class:"file-item",key:e.id},[(0,r.Lk)("div",{class:(0,i.C4)(["file-icon",L(e.type)])},[(0,r.Lk)("i",{class:(0,i.C4)(h(e.type))},null,2)],2),(0,r.Lk)("div",wa,[(0,r.Lk)("div",La,(0,i.v_)(e.name),1),(0,r.Lk)("div",Ca,[(0,r.Lk)("span",Ra,"共享者: "+(0,i.v_)(e.sharedBy),1),(0,r.Lk)("span",Aa,"共享时间: "+(0,i.v_)((0,F.R1)(w.Yq)(e.sharedAt)),1),(0,r.Lk)("span",Va,"权限: "+(0,i.v_)("read"===e.permission?"只读":"读写"),1)])]),(0,r.Lk)("div",xa,[(0,r.bF)(f,{type:"text",onClick:a=>E(e)},{default:(0,r.k6)(()=>[...n[12]||(n[12]=[(0,r.eW)("下载",-1)])]),_:1},8,["onClick"]),(0,r.bF)(f,{type:"text",onClick:a=>K(e)},{default:(0,r.k6)(()=>[...n[13]||(n[13]=[(0,r.eW)("查看",-1)])]),_:1},8,["onClick"]),(0,r.bF)(f,{type:"text",onClick:a=>U(e)},{default:(0,r.k6)(()=>[...n[14]||(n[14]=[(0,r.eW)("移除",-1)])]),_:1},8,["onClick"])])]))),128))])):((0,r.uX)(),(0,r.CE)("div",Wa,[(0,r.bF)(y,{description:"暂无他人共享的文件"})]))]),_:1})]),_:1},8,["modelValue"]),(0,r.bF)(X,{title:c.value,modelValue:u.value,"onUpdate:modelValue":n[8]||(n[8]=e=>u.value=e),width:"500px","close-on-click-modal":!1},{footer:(0,r.k6)(()=>[(0,r.Lk)("span",Ea,[(0,r.bF)(f,{onClick:n[7]||(n[7]=e=>u.value=!1)},{default:(0,r.k6)(()=>[...n[17]||(n[17]=[(0,r.eW)("取消",-1)])]),_:1}),(0,r.bF)(f,{type:"primary",onClick:T,loading:m.value},{default:(0,r.k6)(()=>[...n[18]||(n[18]=[(0,r.eW)("确定",-1)])]),_:1},8,["loading"])])]),default:(0,r.k6)(()=>[(0,r.bF)(M,{model:p.value,"label-width":"100px",rules:k,ref_key:"shareFormRef",ref:v},{default:(0,r.k6)(()=>[(0,r.bF)($,{label:"选择文件",prop:"fileId"},{default:(0,r.k6)(()=>[(0,r.bF)(B,{modelValue:p.value.fileId,"onUpdate:modelValue":n[3]||(n[3]=e=>p.value.fileId=e),placeholder:"请选择要共享的文件",style:{width:"100%"}},{default:(0,r.k6)(()=>[((0,r.uX)(!0),(0,r.CE)(r.FK,null,(0,r.pI)(o.value,e=>((0,r.uX)(),(0,r.Wv)(S,{key:e.id,label:e.name,value:e.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),(0,r.bF)($,{label:"共享给",prop:"sharedTo"},{default:(0,r.k6)(()=>[(0,r.bF)(B,{modelValue:p.value.sharedTo,"onUpdate:modelValue":n[4]||(n[4]=e=>p.value.sharedTo=e),placeholder:"请选择用户",multiple:"",filterable:"",style:{width:"100%"}},{default:(0,r.k6)(()=>[((0,r.uX)(!0),(0,r.CE)(r.FK,null,(0,r.pI)(d.value,e=>((0,r.uX)(),(0,r.Wv)(S,{key:e.id,label:e.username,value:e.username},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),(0,r.bF)($,{label:"权限",prop:"permission"},{default:(0,r.k6)(()=>[(0,r.bF)(P,{modelValue:p.value.permission,"onUpdate:modelValue":n[5]||(n[5]=e=>p.value.permission=e)},{default:(0,r.k6)(()=>[(0,r.bF)(q,{label:"read"},{default:(0,r.k6)(()=>[...n[15]||(n[15]=[(0,r.eW)("只读",-1)])]),_:1}),(0,r.bF)(q,{label:"write"},{default:(0,r.k6)(()=>[...n[16]||(n[16]=[(0,r.eW)("读写",-1)])]),_:1})]),_:1},8,["modelValue"])]),_:1}),(0,r.bF)($,{label:"过期时间",prop:"expiresAt"},{default:(0,r.k6)(()=>[(0,r.bF)(D,{modelValue:p.value.expiresAt,"onUpdate:modelValue":n[6]||(n[6]=e=>p.value.expiresAt=e),type:"date",placeholder:"选择过期时间",style:{width:"100%"}},null,8,["modelValue"])]),_:1})]),_:1},8,["model"])]),_:1},8,["title","modelValue"])])}}};const Ua=(0,V.A)(Ka,[["__scopeId","data-v-08908e38"]]);var Ta=Ua;const Ia={class:"trash-page"},Sa={class:"toolbar"},Ba={class:"toolbar-left"},$a={class:"toolbar-right"},qa={class:"file-list"},Pa={class:"file-name-cell"},Da={class:"file-info"},Ma={class:"file-name"},Xa={class:"file-path"},za={class:"dialog-footer"},ja={class:"dialog-footer"};var Na={__name:"TrashPage",setup(e){const a=(0,F.KR)([]),t=(0,F.KR)([]),l=(0,F.KR)(""),n=(0,F.KR)("deletedAt"),s=(0,F.KR)({visible:!1,title:"",message:"",action:null,loading:!1}),o=(0,F.KR)({visible:!1,loading:!1}),d=(0,r.EW)(()=>{let e=[...a.value];if(l.value){const a=l.value.toLowerCase();e=e.filter(e=>e.name.toLowerCase().includes(a)||e.originalPath.toLowerCase().includes(a))}return e.sort((e,a)=>{switch(n.value){case"deletedAt":return new Date(a.deletedAt)-new Date(e.deletedAt);case"name":return e.name.localeCompare(a.name);case"size":return a.size-e.size;case"type":return e.type.localeCompare(a.type);default:return 0}}),e}),u=(0,r.EW)(()=>t.value.length>0),c=e=>{const a={folder:"el-icon-folder",image:"el-icon-picture",video:"el-icon-film",audio:"el-icon-headset",pdf:"el-icon-document",document:"el-icon-document",archive:"el-icon-folder-opened",code:"el-icon-document-copy",other:"el-icon-document"};return a[e]||a.other},v=e=>{const a={folder:"folder-icon",image:"image-icon",video:"video-icon",audio:"audio-icon",pdf:"pdf-icon",document:"document-icon",archive:"archive-icon",code:"code-icon",other:"other-icon"};return a[e]||a.other},m=e=>{const a={folder:"文件夹",image:"图片",video:"视频",audio:"音频",pdf:"PDF",document:"文档",archive:"压缩包",code:"代码",other:"其他"};return a[e]||a.other},f=e=>e<=3?"urgent":e<=7?"warning":"normal",p=e=>e<=0?"即将删除":1===e?"剩余1天":`剩余${e}天`,k=e=>{t.value=e},g=()=>{},b=()=>{},h=async e=>{try{await _.A.post(`/user/trash/${e.id}/restore`),y.nk.success("文件恢复成功"),await E()}catch(a){y.nk.error("文件恢复失败")}},L=async e=>{try{await _.A.delete(`/user/trash/${e.id}`),y.nk.success("文件已永久删除"),await E()}catch(a){y.nk.error("删除文件失败")}},C=e=>{y.nk.info(`预览文件 "${e.name}"`)},R=()=>{0!==t.value.length&&(s.value={visible:!0,title:"恢复文件",message:`确定要恢复选中的 ${t.value.length} 个文件吗？`,action:"restore",loading:!1})},A=()=>{0!==t.value.length&&(s.value={visible:!0,title:"永久删除",message:`确定要永久删除选中的 ${t.value.length} 个文件吗？此操作无法撤销。`,action:"delete",loading:!1})},V=()=>{0!==a.value.length&&(o.value.visible=!0)},x=async()=>{const{action:e}=s.value;s.value.loading=!0;try{"restore"===e?(await Promise.all(t.value.map(e=>_.A.post(`/user/trash/${e.id}/restore`))),y.nk.success(`已恢复 ${t.value.length} 个文件`)):"delete"===e&&(await Promise.all(t.value.map(e=>_.A.delete(`/user/trash/${e.id}`))),y.nk.success(`已永久删除 ${t.value.length} 个文件`)),s.value.visible=!1,await E()}catch(a){y.nk.error("操作失败")}finally{s.value.loading=!1}},W=async()=>{o.value.loading=!0;try{await _.A.delete("/user/trash"),y.nk.success("回收站已清空"),o.value.visible=!1,await E()}catch(e){y.nk.error("清空回收站失败")}finally{o.value.loading=!1}},E=async()=>{try{const e=await _.A.get("/user/trash");a.value=e.data||[]}catch(e){y.nk.error("获取回收站文件失败")}};return(0,r.sV)(()=>{E()}),(e,t)=>{const y=(0,r.g2)("el-button"),_=(0,r.g2)("el-input"),E=(0,r.g2)("el-option"),K=(0,r.g2)("el-select"),U=(0,r.g2)("el-table-column"),T=(0,r.g2)("el-table"),I=(0,r.g2)("el-dialog");return(0,r.uX)(),(0,r.CE)("div",Ia,[(0,r.Lk)("div",Sa,[(0,r.Lk)("div",Ba,[(0,r.bF)(y,{type:"primary",onClick:R,disabled:!u.value},{default:(0,r.k6)(()=>[...t[6]||(t[6]=[(0,r.eW)(" 恢复选中 ",-1)])]),_:1},8,["disabled"]),(0,r.bF)(y,{type:"danger",onClick:A,disabled:!u.value},{default:(0,r.k6)(()=>[...t[7]||(t[7]=[(0,r.eW)(" 永久删除 ",-1)])]),_:1},8,["disabled"]),(0,r.bF)(y,{onClick:V,disabled:0===a.value.length},{default:(0,r.k6)(()=>[...t[8]||(t[8]=[(0,r.eW)(" 清空回收站 ",-1)])]),_:1},8,["disabled"])]),(0,r.Lk)("div",$a,[(0,r.bF)(_,{modelValue:l.value,"onUpdate:modelValue":t[0]||(t[0]=e=>l.value=e),placeholder:"搜索回收站中的文件...","prefix-icon":"el-icon-search",clearable:"",onInput:g,style:{width:"250px"}},null,8,["modelValue"]),(0,r.bF)(K,{modelValue:n.value,"onUpdate:modelValue":t[1]||(t[1]=e=>n.value=e),onChange:b,style:{width:"150px","margin-left":"10px"}},{default:(0,r.k6)(()=>[(0,r.bF)(E,{label:"按删除时间",value:"deletedAt"}),(0,r.bF)(E,{label:"按文件名",value:"name"}),(0,r.bF)(E,{label:"按文件大小",value:"size"}),(0,r.bF)(E,{label:"按文件类型",value:"type"})]),_:1},8,["modelValue"])])]),(0,r.Lk)("div",qa,[(0,r.bF)(T,{data:d.value,style:{width:"100%"},onSelectionChange:k,"empty-text":"回收站为空"},{default:(0,r.k6)(()=>[(0,r.bF)(U,{type:"selection",width:"55"}),(0,r.bF)(U,{label:"文件名","min-width":"300"},{default:(0,r.k6)(({row:e})=>[(0,r.Lk)("div",Pa,[(0,r.Lk)("div",{class:(0,i.C4)(["file-icon",v(e.type)])},[(0,r.Lk)("i",{class:(0,i.C4)(c(e.type))},null,2)],2),(0,r.Lk)("div",Da,[(0,r.Lk)("div",Ma,(0,i.v_)(e.name),1),(0,r.Lk)("div",Xa,(0,i.v_)(e.originalPath),1)])])]),_:1}),(0,r.bF)(U,{label:"大小",width:"120"},{default:(0,r.k6)(({row:e})=>[(0,r.eW)((0,i.v_)((0,F.R1)(w.v7)(e.size)),1)]),_:1}),(0,r.bF)(U,{label:"类型",width:"120"},{default:(0,r.k6)(({row:e})=>[(0,r.eW)((0,i.v_)(m(e.type)),1)]),_:1}),(0,r.bF)(U,{label:"删除时间",width:"180"},{default:(0,r.k6)(({row:e})=>[(0,r.eW)((0,i.v_)((0,F.R1)(w.Yq)(e.deletedAt)),1)]),_:1}),(0,r.bF)(U,{label:"剩余时间",width:"150"},{default:(0,r.k6)(({row:e})=>[(0,r.Lk)("span",{class:(0,i.C4)(f(e.remainingDays))},(0,i.v_)(p(e.remainingDays)),3)]),_:1}),(0,r.bF)(U,{label:"操作",width:"200"},{default:(0,r.k6)(({row:e})=>[(0,r.bF)(y,{type:"text",onClick:a=>h(e)},{default:(0,r.k6)(()=>[...t[9]||(t[9]=[(0,r.eW)("恢复",-1)])]),_:1},8,["onClick"]),(0,r.bF)(y,{type:"text",onClick:a=>L(e)},{default:(0,r.k6)(()=>[...t[10]||(t[10]=[(0,r.eW)("永久删除",-1)])]),_:1},8,["onClick"]),(0,r.bF)(y,{type:"text",onClick:a=>C(e)},{default:(0,r.k6)(()=>[...t[11]||(t[11]=[(0,r.eW)("预览",-1)])]),_:1},8,["onClick"])]),_:1})]),_:1},8,["data"])]),(0,r.bF)(I,{modelValue:s.value.visible,"onUpdate:modelValue":t[3]||(t[3]=e=>s.value.visible=e),title:s.value.title,width:"400px","close-on-click-modal":!1},{footer:(0,r.k6)(()=>[(0,r.Lk)("span",za,[(0,r.bF)(y,{onClick:t[2]||(t[2]=e=>s.value.visible=!1)},{default:(0,r.k6)(()=>[...t[12]||(t[12]=[(0,r.eW)("取消",-1)])]),_:1}),(0,r.bF)(y,{type:"primary",onClick:x,loading:s.value.loading},{default:(0,r.k6)(()=>[...t[13]||(t[13]=[(0,r.eW)(" 确定 ",-1)])]),_:1},8,["loading"])])]),default:(0,r.k6)(()=>[(0,r.Lk)("p",null,(0,i.v_)(s.value.message),1)]),_:1},8,["modelValue","title"]),(0,r.bF)(I,{modelValue:o.value.visible,"onUpdate:modelValue":t[5]||(t[5]=e=>o.value.visible=e),title:"清空回收站",width:"400px","close-on-click-modal":!1},{footer:(0,r.k6)(()=>[(0,r.Lk)("span",ja,[(0,r.bF)(y,{onClick:t[4]||(t[4]=e=>o.value.visible=!1)},{default:(0,r.k6)(()=>[...t[14]||(t[14]=[(0,r.eW)("取消",-1)])]),_:1}),(0,r.bF)(y,{type:"danger",onClick:W,loading:o.value.loading},{default:(0,r.k6)(()=>[...t[15]||(t[15]=[(0,r.eW)(" 确认清空 ",-1)])]),_:1},8,["loading"])])]),default:(0,r.k6)(()=>[t[16]||(t[16]=(0,r.Lk)("p",null,"确定要清空回收站吗？此操作将永久删除所有文件，且无法恢复。",-1))]),_:1},8,["modelValue"])])}}};const Oa=(0,V.A)(Na,[["__scopeId","data-v-fc32e1b8"]]);var Ga=Oa,Ya=t(5044);const Qa={class:"personal-center-content"},Ha={class:"card-header"},Ja={class:"avatar-section"},Za=["src"],et={class:"user-info"},at={class:"username"},tt={class:"card-body"},lt={class:"info-group"},nt={class:"info-grid"},st={class:"info-item"},rt={class:"item-content"},it={class:"item-value"},ot={class:"info-item"},dt={class:"item-content"},ut={class:"item-value"},ct={class:"info-item"},vt={class:"item-content"},mt={class:"item-value"},ft={class:"info-item"},pt={class:"item-content"},kt={class:"item-value"},gt={class:"quick-actions-card modern-card"},bt={class:"card-title"},ht={class:"actions-grid"},yt=["onClick"],Ft={class:"action-content"},_t={class:"dialog-footer"},wt={class:"crop-container"},Lt={class:"dialog-footer"};var Ct={__name:"SettingsPage",setup(e){const a=(0,F.KR)(!1),t=(0,F.KR)(!1),l=(0,F.KR)(!1),n=(0,F.KR)(),s=(0,F.KR)(!1),o=(0,F.KR)(!1),d=(0,F.KR)(""),u=(0,F.KR)(null),c=(0,F.KR)(null),v=(0,F.Kh)({name:"",gender:"male",email:"",phone:""}),m={name:[{required:!0,message:"请输入姓名",trigger:"blur"},{max:12,message:"昵称长度不能超过12个字符",trigger:"blur"}],gender:[{required:!0,message:"请选择性别",trigger:"change"}],email:[{required:!0,message:"请输入邮箱地址",trigger:"blur"},{type:"email",message:"请输入正确的邮箱地址",trigger:"blur"}],phone:[{required:!0,message:"请输入手机号码",trigger:"blur"},{pattern:/^1[3-9]\d{9}$/,message:"请输入正确的11位手机号码",trigger:"blur"}]},f=()=>{Object.assign(v,{name:w.name,gender:1===w.gender?"male":2===w.gender?"female":"other",email:w.email,phone:w.phone}),t.value=!0},p=()=>y.nk.info("修改密码功能将在未来版本中实现"),k=()=>y.nk.info("通知设置功能将在未来版本中实现"),g=()=>y.nk.info("安全设置功能将在未来版本中实现"),b=()=>y.nk.info("帮助中心功能将在未来版本中实现"),h=[{name:"修改密码",icon:ne.Lock,handler:p},{name:"通知设置",icon:ne.Bell,handler:k},{name:"安全设置",icon:ne.FirstAidKit,handler:g},{name:"帮助中心",icon:ne.QuestionFilled,handler:b}],w=(0,F.Kh)({name:"--",gender:"--",email:"--",phone:"--",lastLoginTime:"--",avatarUrl:"https://picsum.photos/id/1005/200/200"}),L=(0,F.KR)(!1),C=e=>{document.documentElement.style.setProperty("--mouse-x",`${e.clientX}px`),document.documentElement.style.setProperty("--mouse-y",`${e.clientY}px`)},R=e=>{if(!e||"--"===e)return"--";const a=new Date(e);return a.toLocaleString("zh-CN",{year:"numeric",month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit",second:"2-digit"})},A=e=>{const a={0:"未知",1:"男",2:"女"};return a[e]||"未知"},V=()=>{t.value=!1,n.value?.resetFields()},x=async()=>{n.value&&await n.value.validate(async e=>{if(e){l.value=!0;try{const e="male"===v.gender?1:"female"===v.gender?2:0,a=await _.A.put("/user/profile",{nickname:v.name,email:v.email,gender:e.toString(),phone:v.phone});a&&200===a.code||a&&200===a.status?(w.name=v.name,w.email=v.email,w.gender=e,w.phone=v.phone,t.value=!1,y.nk.success("个人信息更新成功")):y.nk.error(a?.message||"更新失败，请重试")}catch(a){y.nk.error("更新个人信息失败")}finally{l.value=!1}}})};(0,r.sV)(()=>{U()});const W=e=>{const a="image/jpeg"===e.raw.type||"image/png"===e.raw.type||"image/gif"===e.raw.type,t=e.raw.size/1024/1024<2;a?t?(c.value=e.raw,d.value=URL.createObjectURL(e.raw),s.value=!0):y.nk.error("头像图片大小不能超过 2MB!"):y.nk.error("头像图片只能是 JPG/PNG/GIF 格式!")},E=async()=>{if(u.value){o.value=!0;try{const{canvas:e}=u.value.getResult();e.toBlob(async e=>{if(!e)return y.nk.error("图片处理失败"),void(o.value=!1);try{const a=new FormData;a.append("file",e,"avatar.jpg"),console.log("前端：开始上传头像，FormData内容:",a);const t=await _.A.post("/user/avatar/upload",a);if(console.log("前端：收到响应:",t),!t||200!==t.code)throw new Error(t?.message||"上传失败");w.avatarUrl=t.data,s.value=!1,y.nk.success("头像更新成功")}catch(a){let e="头像上传失败";e=a.response?a.response.data?.message||`服务器错误: ${a.response.status}`:a.request?"网络连接失败，请检查网络设置":a.message||"请重试",y.nk.error(e)}finally{o.value=!1}},"image/jpeg",.9)}catch(e){y.nk.error("图片裁剪失败: "+(e.message||"请重试")),o.value=!1}}else y.nk.error("裁剪器未初始化")},K=()=>{s.value=!1,d.value&&(URL.revokeObjectURL(d.value),d.value=""),c.value=null},U=async()=>{try{const e=await _.A.get("/user/profile");if(e.data){const a=e.data.data||e.data;Object.assign(w,{name:a.nickname||a.email||"--",gender:a.gender||0,birthdate:"--",email:a.email||"--",phone:a.phone||"--",lastLoginTime:a.lastLoginTime||"--",avatarUrl:a.avatar||w.avatarUrl}),v.name=w.name,v.gender=1===w.gender?"male":2===w.gender?"female":"other",v.email=w.email,v.phone=w.phone}}catch(e){y.nk.error("获取用户信息失败")}};return(e,c)=>{const p=(0,r.g2)("el-icon"),k=(0,r.g2)("el-upload"),g=(0,r.g2)("el-button"),b=(0,r.g2)("el-input"),y=(0,r.g2)("el-form-item"),_=(0,r.g2)("el-radio"),U=(0,r.g2)("el-radio-group"),T=(0,r.g2)("el-form"),I=(0,r.g2)("el-dialog");return(0,r.uX)(),(0,r.CE)("div",{class:"personal-center-page",onMousemove:C},[(0,r.Lk)("div",Qa,[(0,r.Lk)("div",{class:(0,i.C4)(["personal-info-card modern-card",{"panel-hover":L.value}])},[(0,r.Lk)("div",Ha,[(0,r.Lk)("div",Ja,[(0,r.bF)(k,{class:"avatar-uploader","auto-upload":!1,"show-file-list":!1,"on-change":W,"before-upload":e.beforeAvatarUpload},{default:(0,r.k6)(()=>[(0,r.Lk)("div",{class:"avatar-container",onMouseenter:c[0]||(c[0]=e=>a.value=!0),onMouseleave:c[1]||(c[1]=e=>a.value=!1)},[w.avatarUrl?((0,r.uX)(),(0,r.CE)("img",{key:0,src:w.avatarUrl,class:"avatar"},null,8,Za)):((0,r.uX)(),(0,r.Wv)(p,{key:1,class:"avatar-uploader-icon"},{default:(0,r.k6)(()=>[(0,r.bF)((0,F.R1)(ne.Plus))]),_:1})),(0,r.Lk)("div",{class:(0,i.C4)(["avatar-overlay",{show:a.value}])},[(0,r.bF)(p,{class:"edit-icon"},{default:(0,r.k6)(()=>[(0,r.bF)((0,F.R1)(ne.Edit))]),_:1})],2)],32)]),_:1},8,["before-upload"]),(0,r.Lk)("div",et,[(0,r.Lk)("h1",at,(0,i.v_)(w.name),1)])]),(0,r.bF)(g,{type:"primary",size:"small",onClick:f,class:"edit-button",round:""},{default:(0,r.k6)(()=>[(0,r.bF)(p,null,{default:(0,r.k6)(()=>[(0,r.bF)((0,F.R1)(ne.Edit))]),_:1}),c[8]||(c[8]=(0,r.eW)(" 编辑资料 ",-1))]),_:1})]),(0,r.Lk)("div",tt,[(0,r.Lk)("div",lt,[(0,r.Lk)("div",nt,[(0,r.Lk)("div",st,[(0,r.bF)(p,{class:"item-icon"},{default:(0,r.k6)(()=>[(0,r.bF)((0,F.R1)(ne.User))]),_:1}),(0,r.Lk)("div",rt,[c[9]||(c[9]=(0,r.Lk)("p",{class:"item-label"},"性别",-1)),(0,r.Lk)("p",it,(0,i.v_)(A(w.gender)),1)])]),(0,r.Lk)("div",ot,[(0,r.bF)(p,{class:"item-icon"},{default:(0,r.k6)(()=>[(0,r.bF)((0,F.R1)(ne.Clock))]),_:1}),(0,r.Lk)("div",dt,[c[10]||(c[10]=(0,r.Lk)("p",{class:"item-label"},"最后登录时间",-1)),(0,r.Lk)("p",ut,(0,i.v_)(R(w.lastLoginTime)),1)])]),(0,r.Lk)("div",ct,[(0,r.bF)(p,{class:"item-icon"},{default:(0,r.k6)(()=>[(0,r.bF)((0,F.R1)(ne.Notification))]),_:1}),(0,r.Lk)("div",vt,[c[11]||(c[11]=(0,r.Lk)("p",{class:"item-label"},"邮箱",-1)),(0,r.Lk)("p",mt,(0,i.v_)(w.email),1)])]),(0,r.Lk)("div",ft,[(0,r.bF)(p,{class:"item-icon"},{default:(0,r.k6)(()=>[(0,r.bF)((0,F.R1)(ne.Phone))]),_:1}),(0,r.Lk)("div",pt,[c[12]||(c[12]=(0,r.Lk)("p",{class:"item-label"},"手机号码",-1)),(0,r.Lk)("p",kt,(0,i.v_)(w.phone),1)])])])])])],2),(0,r.Lk)("div",gt,[(0,r.Lk)("div",bt,[(0,r.bF)(p,{class:"title-icon"},{default:(0,r.k6)(()=>[(0,r.bF)((0,F.R1)(ne.Setting))]),_:1}),c[13]||(c[13]=(0,r.Lk)("span",null,"账户设置",-1))]),(0,r.Lk)("div",ht,[((0,r.uX)(),(0,r.CE)(r.FK,null,(0,r.pI)(h,e=>(0,r.Lk)("div",{key:e.name,class:"action-item",onClick:e.handler},[(0,r.Lk)("div",Ft,[(0,r.bF)(p,{class:"action-icon"},{default:(0,r.k6)(()=>[((0,r.uX)(),(0,r.Wv)((0,r.$y)(e.icon)))]),_:2},1024),(0,r.Lk)("span",null,(0,i.v_)(e.name),1)]),(0,r.bF)(p,{class:"arrow-icon"},{default:(0,r.k6)(()=>[(0,r.bF)((0,F.R1)(ne.ArrowRight))]),_:1})],8,yt)),64))])])]),(0,r.bF)(I,{modelValue:t.value,"onUpdate:modelValue":c[6]||(c[6]=e=>t.value=e),title:"编辑个人信息",width:"600px","before-close":V},{footer:(0,r.k6)(()=>[(0,r.Lk)("span",_t,[(0,r.bF)(g,{onClick:V},{default:(0,r.k6)(()=>[...c[17]||(c[17]=[(0,r.eW)("取消",-1)])]),_:1}),(0,r.bF)(g,{type:"primary",onClick:x,loading:l.value},{default:(0,r.k6)(()=>[...c[18]||(c[18]=[(0,r.eW)(" 保存 ",-1)])]),_:1},8,["loading"])])]),default:(0,r.k6)(()=>[(0,r.bF)(T,{ref_key:"editFormRef",ref:n,model:v,rules:m,"label-width":"100px"},{default:(0,r.k6)(()=>[(0,r.bF)(y,{label:"姓名",prop:"name"},{default:(0,r.k6)(()=>[(0,r.bF)(b,{modelValue:v.name,"onUpdate:modelValue":c[2]||(c[2]=e=>v.name=e),placeholder:"请输入姓名",maxlength:"12","show-word-limit":""},null,8,["modelValue"])]),_:1}),(0,r.bF)(y,{label:"性别",prop:"gender"},{default:(0,r.k6)(()=>[(0,r.bF)(U,{modelValue:v.gender,"onUpdate:modelValue":c[3]||(c[3]=e=>v.gender=e)},{default:(0,r.k6)(()=>[(0,r.bF)(_,{label:"male"},{default:(0,r.k6)(()=>[...c[14]||(c[14]=[(0,r.eW)("男",-1)])]),_:1}),(0,r.bF)(_,{label:"female"},{default:(0,r.k6)(()=>[...c[15]||(c[15]=[(0,r.eW)("女",-1)])]),_:1}),(0,r.bF)(_,{label:"other"},{default:(0,r.k6)(()=>[...c[16]||(c[16]=[(0,r.eW)("其他",-1)])]),_:1})]),_:1},8,["modelValue"])]),_:1}),(0,r.bF)(y,{label:"邮箱",prop:"email"},{default:(0,r.k6)(()=>[(0,r.bF)(b,{modelValue:v.email,"onUpdate:modelValue":c[4]||(c[4]=e=>v.email=e),placeholder:"请输入邮箱地址"},null,8,["modelValue"])]),_:1}),(0,r.bF)(y,{label:"手机号码",prop:"phone"},{default:(0,r.k6)(()=>[(0,r.bF)(b,{modelValue:v.phone,"onUpdate:modelValue":c[5]||(c[5]=e=>v.phone=e),placeholder:"请输入手机号码",maxlength:"11"},null,8,["modelValue"])]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue"]),(0,r.bF)(I,{modelValue:s.value,"onUpdate:modelValue":c[7]||(c[7]=e=>s.value=e),title:"裁剪头像",width:"600px","before-close":K},{footer:(0,r.k6)(()=>[(0,r.Lk)("span",Lt,[(0,r.bF)(g,{onClick:K},{default:(0,r.k6)(()=>[...c[19]||(c[19]=[(0,r.eW)("取消",-1)])]),_:1}),(0,r.bF)(g,{type:"primary",onClick:E,loading:o.value},{default:(0,r.k6)(()=>[...c[20]||(c[20]=[(0,r.eW)(" 确认裁剪并上传 ",-1)])]),_:1},8,["loading"])])]),default:(0,r.k6)(()=>[(0,r.Lk)("div",wt,[(0,r.bF)((0,F.R1)(Ya.IO),{ref_key:"cropperRef",ref:u,src:d.value,"stencil-props":{aspectRatio:1},canvas:{width:300,height:300},"stencil-size":{width:250,height:250},"image-restriction":"stencil","resize-image":{adjustStencil:!1},"move-image":{enabled:!0},"default-size":{width:250,height:250}},null,8,["src"])])]),_:1},8,["modelValue"])],32)}}};const Rt=(0,V.A)(Ct,[["__scopeId","data-v-9471bd08"]]);var At=Rt;const Vt=[{path:"/",component:W,meta:{title:"枫叶网盘",requiresAuth:!1}},{path:"/login",name:"LoginPage",component:B,meta:{title:"登录 - 枫叶网盘",requiresAuth:!1}},{path:"/user",component:le,meta:{requiresAuth:!0,requiresAdmin:!1},children:[{path:"",name:"FilesPage",component:Pe,meta:{title:"枫叶网盘 - 我的文件",requiresAuth:!0,requiresAdmin:!1}},{path:"dashboard",name:"DashboardPage",component:ra,meta:{title:"枫叶网盘 - 仪表盘",requiresAuth:!0,requiresAdmin:!1}},{path:"shared",name:"SharedPage",component:Ta,meta:{title:"枫叶网盘 - 共享文件",requiresAuth:!0,requiresAdmin:!1}},{path:"trash",name:"TrashPage",component:Ga,meta:{title:"枫叶网盘 - 回收站",requiresAuth:!0,requiresAdmin:!1}},{path:"settings",name:"SettingsPage",component:At,meta:{title:"枫叶网盘 - 设置",requiresAuth:!0,requiresAdmin:!1}}]},{path:"/admin",component:pe,meta:{requiresAuth:!0,requiresAdmin:!0},children:[{path:"",name:"AdminDashboard",component:()=>t.e(596).then(t.bind(t,7596)),meta:{title:"枫叶网盘 - 管理员仪表盘",requiresAuth:!0,requiresAdmin:!0}},{path:"users",name:"AdminUsers",component:()=>t.e(172).then(t.bind(t,4172)),meta:{title:"枫叶网盘 - 用户管理",requiresAuth:!0,requiresAdmin:!0}},{path:"system",name:"AdminSystem",component:()=>t.e(188).then(t.bind(t,3188)),meta:{title:"枫叶网盘 - 系统设置",requiresAuth:!0,requiresAdmin:!0}},{path:"logs",name:"AdminLogs",component:()=>t.e(916).then(t.bind(t,916)),meta:{title:"枫叶网盘 - 操作日志",requiresAuth:!0,requiresAdmin:!0}}]},{path:"/:pathMatch(.*)*",redirect:"/"}],xt=(0,s.aE)({history:(0,s.LA)(),routes:Vt});xt.beforeEach(async(e,a,t)=>{if(e.meta.title&&(document.title=e.meta.title),e.meta.requiresAuth){if(!w.M3())return void t("/login");if(!R.state.user)try{await R.fetchCurrentUser(),await R.fetchStorageInfo()}catch(l){return!l.response||401!==l.response.status&&403!==l.response.status||w.eF(),void t("/login")}if(e.meta.requiresAdmin&&!R.state.isAdmin)return void t("/user")}"/login"===e.path&&w.M3()?R.state.isAdmin?t("/admin"):t("/user"):t()});var Wt=xt;const Et={id:"app"};function Kt(e,a){const t=(0,r.g2)("router-view");return(0,r.uX)(),(0,r.CE)("div",Et,[(0,r.bF)(t)])}const Ut={},Tt=(0,V.A)(Ut,[["render",Kt]]);var It=Tt;const St={maxFileSize:150,appName:"LeafPan网盘系统",apiVersion:"v1"};let Bt={...St};const $t=async()=>{try{const e=await _.A.get("/config");if(e&&e.data)return Bt={...St,...e.data},Bt}catch(e){}return{...St}};$t().catch(()=>{});const qt=(0,l.Ef)(It);qt.use(n.A),qt.use(Wt);for(const[Pt,Dt]of Object.entries(ne))qt.component(Pt,Dt);qt.config.globalProperties.$store=R,R.init().then(()=>{}).catch(e=>{}),qt.mount("#app"),$t().then(e=>{}).catch(e=>{})}},a={};function t(l){var n=a[l];if(void 0!==n)return n.exports;var s=a[l]={exports:{}};return e[l].call(s.exports,s,s.exports,t),s.exports}t.m=e,function(){var e=[];t.O=function(a,l,n,s){if(!l){var r=1/0;for(u=0;u<e.length;u++){l=e[u][0],n=e[u][1],s=e[u][2];for(var i=!0,o=0;o<l.length;o++)(!1&s||r>=s)&&Object.keys(t.O).every(function(e){return t.O[e](l[o])})?l.splice(o--,1):(i=!1,s<r&&(r=s));if(i){e.splice(u--,1);var d=n();void 0!==d&&(a=d)}}return a}s=s||0;for(var u=e.length;u>0&&e[u-1][2]>s;u--)e[u]=e[u-1];e[u]=[l,n,s]}}(),function(){t.n=function(e){var a=e&&e.__esModule?function(){return e["default"]}:function(){return e};return t.d(a,{a:a}),a}}(),function(){t.d=function(e,a){for(var l in a)t.o(a,l)&&!t.o(e,l)&&Object.defineProperty(e,l,{enumerable:!0,get:a[l]})}}(),function(){t.f={},t.e=function(e){return Promise.all(Object.keys(t.f).reduce(function(a,l){return t.f[l](e,a),a},[]))}}(),function(){t.u=function(e){return"js/"+e+"."+{172:"257ba8ab",188:"7492e817",596:"e7ea0e62",916:"f77ae491"}[e]+".js"}}(),function(){t.miniCssF=function(e){return"css/"+e+"."+{172:"ae078ee4",188:"b54b03ce",596:"625e45a7",916:"d4cda5d2"}[e]+".css"}}(),function(){t.g=function(){if("object"===typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(e){if("object"===typeof window)return window}}()}(),function(){t.o=function(e,a){return Object.prototype.hasOwnProperty.call(e,a)}}(),function(){var e={},a="frontend:";t.l=function(l,n,s,r){if(e[l])e[l].push(n);else{var i,o;if(void 0!==s)for(var d=document.getElementsByTagName("script"),u=0;u<d.length;u++){var c=d[u];if(c.getAttribute("src")==l||c.getAttribute("data-webpack")==a+s){i=c;break}}i||(o=!0,i=document.createElement("script"),i.charset="utf-8",t.nc&&i.setAttribute("nonce",t.nc),i.setAttribute("data-webpack",a+s),i.src=l),e[l]=[n];var v=function(a,t){i.onerror=i.onload=null,clearTimeout(m);var n=e[l];if(delete e[l],i.parentNode&&i.parentNode.removeChild(i),n&&n.forEach(function(e){return e(t)}),a)return a(t)},m=setTimeout(v.bind(null,void 0,{type:"timeout",target:i}),12e4);i.onerror=v.bind(null,i.onerror),i.onload=v.bind(null,i.onload),o&&document.head.appendChild(i)}}}(),function(){t.r=function(e){"undefined"!==typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})}}(),function(){t.p="/"}(),function(){if("undefined"!==typeof document){var e=function(e,a,l,n,s){var r=document.createElement("link");r.rel="stylesheet",r.type="text/css",t.nc&&(r.nonce=t.nc);var i=function(t){if(r.onerror=r.onload=null,"load"===t.type)n();else{var l=t&&t.type,i=t&&t.target&&t.target.href||a,o=new Error("Loading CSS chunk "+e+" failed.\n("+l+": "+i+")");o.name="ChunkLoadError",o.code="CSS_CHUNK_LOAD_FAILED",o.type=l,o.request=i,r.parentNode&&r.parentNode.removeChild(r),s(o)}};return r.onerror=r.onload=i,r.href=a,l?l.parentNode.insertBefore(r,l.nextSibling):document.head.appendChild(r),r},a=function(e,a){for(var t=document.getElementsByTagName("link"),l=0;l<t.length;l++){var n=t[l],s=n.getAttribute("data-href")||n.getAttribute("href");if("stylesheet"===n.rel&&(s===e||s===a))return n}var r=document.getElementsByTagName("style");for(l=0;l<r.length;l++){n=r[l],s=n.getAttribute("data-href");if(s===e||s===a)return n}},l=function(l){return new Promise(function(n,s){var r=t.miniCssF(l),i=t.p+r;if(a(r,i))return n();e(l,i,null,n,s)})},n={524:0};t.f.miniCss=function(e,a){var t={172:1,188:1,596:1,916:1};n[e]?a.push(n[e]):0!==n[e]&&t[e]&&a.push(n[e]=l(e).then(function(){n[e]=0},function(a){throw delete n[e],a}))}}}(),function(){var e={524:0};t.f.j=function(a,l){var n=t.o(e,a)?e[a]:void 0;if(0!==n)if(n)l.push(n[2]);else{var s=new Promise(function(t,l){n=e[a]=[t,l]});l.push(n[2]=s);var r=t.p+t.u(a),i=new Error,o=function(l){if(t.o(e,a)&&(n=e[a],0!==n&&(e[a]=void 0),n)){var s=l&&("load"===l.type?"missing":l.type),r=l&&l.target&&l.target.src;i.message="Loading chunk "+a+" failed.\n("+s+": "+r+")",i.name="ChunkLoadError",i.type=s,i.request=r,n[1](i)}};t.l(r,o,"chunk-"+a,a)}},t.O.j=function(a){return 0===e[a]};var a=function(a,l){var n,s,r=l[0],i=l[1],o=l[2],d=0;if(r.some(function(a){return 0!==e[a]})){for(n in i)t.o(i,n)&&(t.m[n]=i[n]);if(o)var u=o(t)}for(a&&a(l);d<r.length;d++)s=r[d],t.o(e,s)&&e[s]&&e[s][0](),e[s]=0;return t.O(u)},l=self["webpackChunkfrontend"]=self["webpackChunkfrontend"]||[];l.forEach(a.bind(null,0)),l.push=a.bind(null,l.push.bind(l))}();var l=t.O(void 0,[96],function(){return t(9321)});l=t.O(l)})();